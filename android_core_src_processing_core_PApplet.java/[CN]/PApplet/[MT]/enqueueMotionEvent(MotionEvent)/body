{
synchronized (motionLock) {
    if (motionEventQueue == null) {
      motionEventQueue=new PMotionEvent[20];
      for (int i=0; i < motionEventQueue.length; i++) {
        motionEventQueue[i]=new PMotionEvent();
      }
    }
    int historyCount=event.getHistorySize();
    if (motionEventCount + historyCount >= motionEventQueue.length) {
      int atLeast=motionEventCount + historyCount + 1;
      PMotionEvent[] temp=new PMotionEvent[max(atLeast,motionEventCount << 1)];
      println("motion: " + motionEventCount + " "+ historyCount+ " "+ motionEventQueue.length);
      println("allocating " + temp.length + " entries for motion events");
      System.arraycopy(motionEventQueue,0,temp,0,motionEventCount);
      motionEventQueue=temp;
      for (int i=motionEventCount; i < motionEventQueue.length; i++) {
        motionEventQueue[i]=new PMotionEvent();
      }
    }
    PMotionEvent pme=motionEventQueue[motionEventCount + historyCount];
    pme.action=event.getAction();
    pme.motionX=event.getX();
    pme.motionY=event.getY();
    pme.motionPressure=event.getPressure();
    pme.mouseX=(int)pme.motionX;
    pme.mouseY=(int)pme.motionY;
    if (pme.action == MotionEvent.ACTION_MOVE && historyCount > 0) {
      for (int i=0; i < historyCount; i++) {
        PMotionEvent hist=motionEventQueue[motionEventCount++];
        hist.action=pme.action;
        hist.motionX=event.getHistoricalX(i);
        hist.motionY=event.getHistoricalY(i);
        hist.motionPressure=event.getHistoricalPressure(i);
        hist.mouseX=(int)hist.motionX;
        hist.mouseY=(int)hist.motionY;
      }
    }
    motionEventCount++;
  }
}

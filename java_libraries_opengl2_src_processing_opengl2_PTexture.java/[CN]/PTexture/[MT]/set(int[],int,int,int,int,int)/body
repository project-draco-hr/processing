{
  if (pixels == null) {
    throw new RuntimeException("PTexture: null pixels array");
  }
  if (pixels.length != w * h) {
    throw new RuntimeException("PTexture: wrong length of pixels array");
  }
  if (glID == 0) {
    createTexture(width,height);
  }
  getGl().glEnable(glTarget);
  getGl().glBindTexture(glTarget,glID);
  if (usingMipmaps) {
    if (PGraphicsOpenGL2.mipmapGeneration) {
      int[] rgbaPixels=new int[w * h];
      convertToRGBA(pixels,rgbaPixels,format,w,h);
      getGl().glTexParameteri(GL.GL_TEXTURE_2D,GL2.GL_GENERATE_MIPMAP,GL.GL_TRUE);
      setTexels(x,y,w,h,rgbaPixels);
      rgbaPixels=null;
    }
 else {
    }
  }
 else {
    int[] rgbaPixels=new int[w * h];
    convertToRGBA(pixels,rgbaPixels,format,w,h);
    setTexels(x,y,w,h,rgbaPixels);
    rgbaPixels=null;
  }
  getGl().glBindTexture(glTarget,0);
  getGl().glDisable(glTarget);
}

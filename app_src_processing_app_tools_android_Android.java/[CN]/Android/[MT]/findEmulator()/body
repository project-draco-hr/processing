{
  String portString=Preferences.get("android.emulator.port");
  if (portString == null) {
    portString="5566";
    Preferences.set("android.emulator.port",portString);
  }
  String name="emulator-" + portString;
  try {
    String[] devices=Debug.listDevices();
    for (    String s : devices) {
      if (s.equals(name)) {
        return name;
      }
    }
  }
 catch (  IOException e) {
    editor.statusError(e);
    return null;
  }
  try {
    if (emulatorProcess != null) {
      try {
        int result=emulatorProcess.exitValue();
        emulatorProcess.destroy();
      }
 catch (      IllegalThreadStateException itse) {
      }
    }
    editor.statusNotice("Starting new Android emulator.");
    String[] cmd=new String[]{"emulator","-avd",getDefaultDevice(),"-port",portString,"-logcat","'*:i'","-no-boot-anim"};
    emulatorProcess=Runtime.getRuntime().exec(cmd);
    System.out.println(PApplet.join(cmd," "));
    new StreamRedirectThread("android-emulator-out",emulatorProcess.getInputStream(),System.out).start();
    new StreamRedirectThread("android-emulator-err",emulatorProcess.getErrorStream(),System.err).start();
    return name;
  }
 catch (  IOException e) {
    editor.statusError(e);
    return null;
  }
}

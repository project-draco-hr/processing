{
  Platform platform=Base.getPlatform();
  String oldPath=Preferences.get("android.sdk.path");
  if (oldPath != null) {
    File oldFolder=new File(oldPath);
    if (!oldFolder.exists()) {
      Preferences.unset("android.sdk.path");
    }
  }
  String envPath=platform.getenv("ANDROID_SDK");
  if (envPath != null) {
    sdkPath=envPath;
    Preferences.set("android.sdk.path",envPath);
  }
 else {
    sdkPath=Preferences.get("android.sdk.path");
    if (sdkPath == null) {
      int result=Base.showYesNoQuestion(editor,"Android SDK",ANDROID_SDK_PRIMARY,ANDROID_SDK_SECONDARY);
      if (result == JOptionPane.YES_OPTION) {
        File folder=Base.selectFolder(SELECT_ANDROID_SDK_FOLDER,null,editor);
        if (folder != null) {
          if (Base.isWindows()) {
            if (new File(folder,"tools/android.exe").exists()) {
              toolName="android.exe";
            }
 else             if (new File(folder,"tools/android.bat").exists()) {
              toolName="android.bat";
            }
          }
 else           if (new File(folder,"tools/android").exists()) {
            toolName="android";
          }
          if (toolName != null) {
            sdkPath=folder.getAbsolutePath();
            Preferences.set("android.sdk.path",sdkPath);
          }
 else {
            System.err.println("Could not find the android executable inside " + folder.getAbsolutePath() + "/tools/");
            JOptionPane.showMessageDialog(editor,NOT_ANDROID_SDK);
            return false;
          }
        }
      }
 else       if (result == JOptionPane.NO_OPTION) {
        Base.openURL(ANDROID_SDK_URL);
      }
    }
  }
  if (sdkPath == null) {
    return false;
  }
  if (envPath == null) {
    platform.setenv("ANDROID_SDK",sdkPath);
  }
  return true;
}

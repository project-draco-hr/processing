{
  String[] vmParams=getMachineParams();
  String[] sketchParams=getSketchParams(presenting);
  int port=8000 + (int)(Math.random() * 1000);
  String portStr=String.valueOf(port);
  String jdwpArg="-agentlib:jdwp=transport=dt_socket,address=" + portStr + ",server=y,suspend=y";
  String[] commandArgs=null;
  if (!Base.isMacOS()) {
    commandArgs=new String[]{"java",jdwpArg};
  }
 else {
    if (System.getProperty("os.version").startsWith("10.6")) {
      commandArgs=new String[]{"/usr/libexec/java_home","--version","1.6","--exec","java","-d" + Base.getNativeBits(),jdwpArg};
    }
 else {
      commandArgs=new String[]{"/usr/libexec/java_home","--request","--version","1.6","--exec","java","-d" + Base.getNativeBits(),jdwpArg};
    }
  }
  commandArgs=PApplet.concat(commandArgs,vmParams);
  commandArgs=PApplet.concat(commandArgs,sketchParams);
  launchJava(commandArgs);
  AttachingConnector connector=(AttachingConnector)findConnector("com.sun.jdi.SocketAttach");
  Map arguments=connector.defaultArguments();
  Connector.Argument portArg=(Connector.Argument)arguments.get("port");
  portArg.setValue(portStr);
  try {
    while (true) {
      try {
        vm=connector.attach(arguments);
        if (vm != null) {
          return true;
        }
      }
 catch (      IOException e) {
        try {
          Thread.sleep(100);
        }
 catch (        InterruptedException e1) {
          e1.printStackTrace();
        }
      }
    }
  }
 catch (  IllegalConnectorArgumentsException exc) {
    throw new Error("Internal error: " + exc);
  }
}

{
  ensureExistence();
  if (current.modified) {
    current.program=editor.getText();
  }
  if (isReadOnly()) {
    Base.showMessage("Sketch is read-only","Some files are marked \"read-only\", so you'll\n" + "need to re-save this sketch to another location.");
    if (!saveAs())     return false;
  }
  for (int i=0; i < codeCount; i++) {
    if (code[i].modified)     code[i].save();
  }
  calcModified();
  return true;
}

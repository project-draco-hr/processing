{
  final Platform platform=Base.getPlatform();
  final String sdkEnvPath=platform.getenv("ANDROID_SDK");
  if (sdkEnvPath != null) {
    try {
      final AndroidSDK androidSDK=new AndroidSDK(sdkEnvPath);
      Preferences.set("android.sdk.path",sdkEnvPath);
      return androidSDK;
    }
 catch (    final BadSDKException drop) {
    }
  }
  final String sdkPrefsPath=Preferences.get("android.sdk.path");
  if (sdkPrefsPath != null) {
    try {
      final AndroidSDK androidSDK=new AndroidSDK(sdkPrefsPath);
      Preferences.set("android.sdk.path",sdkPrefsPath);
      return androidSDK;
    }
 catch (    final BadSDKException wellThatsThat) {
      Preferences.unset("android.sdk.path");
    }
  }
  final int result=Base.showYesNoQuestion(window,"Android SDK",ANDROID_SDK_PRIMARY,ANDROID_SDK_SECONDARY);
  if (result == JOptionPane.CANCEL_OPTION) {
    throw new BadSDKException("User cancelled attempt to find SDK.");
  }
  if (result == JOptionPane.NO_OPTION) {
    Base.openURL(ANDROID_SDK_URL);
    throw new BadSDKException("No SDK installed.");
  }
  while (true) {
    final File folder=Base.selectFolder(SELECT_ANDROID_SDK_FOLDER,null,window);
    if (folder == null) {
      throw new BadSDKException("User cancelled attempt to find SDK.");
    }
    final String selectedPath=folder.getAbsolutePath();
    try {
      final AndroidSDK androidSDK=new AndroidSDK(selectedPath);
      Preferences.set("android.sdk.path",selectedPath);
      return androidSDK;
    }
 catch (    final BadSDKException nope) {
      JOptionPane.showMessageDialog(window,NOT_ANDROID_SDK);
    }
  }
}

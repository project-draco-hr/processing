{
  Messages.log("* handleRefactor");
  if (editor.hasJavaTabs())   return;
  log("Last clicked word:" + lastClickedWord);
  if (lastClickedWord == null && getSelectedText() == null) {
    editor.statusMessage("Highlight the class/function/variable name first",EditorStatus.NOTICE);
    return;
  }
  if (errorCheckerService.hasSyntaxErrors()) {
    editor.statusMessage("Can't perform action until syntax errors are fixed :(",EditorStatus.WARNING);
    return;
  }
  DefaultMutableTreeNode defCU=findAllOccurrences();
  final String selText=lastClickedWord == null ? getSelectedText() : lastClickedWord;
  if (defCU == null) {
    editor.statusMessage(selText + " isn't defined in this sketch, " + "so it cannot be renamed",EditorStatus.ERROR);
    return;
  }
  EventQueue.invokeLater(new Runnable(){
    @Override public void run(){
      gui.handleRefactor(selText);
    }
  }
);
}

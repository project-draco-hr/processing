{
  ArrayList<Library> oldLibs=editor.getMode().contribLibraries;
  Iterator<Library> it=newLibs.iterator();
  while (it.hasNext()) {
    Library lib=it.next();
    for (    Library oldLib : oldLibs) {
      if (oldLib.getName().equals(lib.getName()) && oldLib.libraryFolder.exists()) {
        int result=Base.showYesNoQuestion(editor,"Replace","Replace existing \"" + oldLib.getName() + "\" library?","An existing copy of the \"" + oldLib.getName() + "\" library<br>"+ "has been found in your sketchbook. Clicking ???Yes???<br>"+ "will move the existing library to a backup folder<br>"+ " in <i>libraries/old</i> before replacing it.");
        if (result == JOptionPane.YES_OPTION) {
          if (!backupLibrary(oldLib)) {
            return null;
          }
        }
 else {
          it.remove();
        }
        break;
      }
    }
  }
  it=newLibs.iterator();
  while (it.hasNext()) {
    Library newLib=it.next();
    String libFolderName=newLib.folder.getName();
    File libFolder=new File(editor.getBase().getSketchbookLibrariesFolder(),libFolderName);
    if (newLib.folder.renameTo(libFolder)) {
      newLib.folder=libFolder;
    }
 else {
      Base.showWarning("Trouble moving new library to the sketchbook","Could not move \"" + newLib.getName() + "\" to "+ libFolder.getAbsolutePath()+ ".\n",null);
      it.remove();
    }
  }
  return newLibs;
}

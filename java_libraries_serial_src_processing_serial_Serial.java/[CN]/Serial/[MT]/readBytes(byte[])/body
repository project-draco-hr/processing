{
  if (bufferIndex == bufferLast)   return 0;
synchronized (buffer) {
    int length=bufferLast - bufferIndex;
    if (length > outgoing.length)     length=outgoing.length;
    System.arraycopy(buffer,bufferIndex,outgoing,0,length);
    bufferIndex+=length;
    if (bufferIndex == bufferLast) {
      bufferIndex=0;
      bufferLast=0;
    }
    return length;
  }
}

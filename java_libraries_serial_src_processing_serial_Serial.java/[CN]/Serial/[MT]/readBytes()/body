{
  if (inBuffer == readOffset) {
    return null;
  }
  long start=System.nanoTime();
synchronized (buffer) {
    long len=System.nanoTime() - start;
    if (maxSyncTime < len) {
      maxSyncTime=len;
    }
    sumSyncTime+=len;
    countSyncs++;
    byte[] ret=new byte[inBuffer - readOffset];
    System.arraycopy(buffer,readOffset,ret,0,ret.length);
    inBuffer=0;
    readOffset=0;
    return ret;
  }
}

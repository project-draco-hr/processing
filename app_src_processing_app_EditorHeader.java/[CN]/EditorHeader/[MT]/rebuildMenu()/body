{
  if (menu != null) {
    menu.removeAll();
  }
 else {
    menu=new JMenu();
    popup=menu.getPopupMenu();
    add(popup);
    popup.setLightWeightPopupEnabled(true);
  }
  JMenuItem item;
  item=Base.newJMenuItemShift("New Tab",'N');
  item.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      editor.getSketch().handleNewCode();
    }
  }
);
  menu.add(item);
  item=new JMenuItem("Rename");
  item.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      editor.getSketch().handleRenameCode();
    }
  }
);
  menu.add(item);
  item=new JMenuItem("Delete");
  item.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      editor.getSketch().handleDeleteCode();
    }
  }
);
  menu.add(item);
  menu.addSeparator();
  item=new JMenuItem("Previous Tab");
  KeyStroke ctrlAltLeft=KeyStroke.getKeyStroke(KeyEvent.VK_LEFT,Base.SHORTCUT_ALT_KEY_MASK);
  item.setAccelerator(ctrlAltLeft);
  menu.add(item);
  item=new JMenuItem("Next Tab");
  KeyStroke ctrlAltRight=KeyStroke.getKeyStroke(KeyEvent.VK_RIGHT,Base.SHORTCUT_ALT_KEY_MASK);
  item.setAccelerator(ctrlAltRight);
  menu.add(item);
  Sketch sketch=editor.getSketch();
  if (sketch != null) {
    menu.addSeparator();
    ActionListener jumpListener=new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        editor.getSketch().setCurrentCode(e.getActionCommand());
      }
    }
;
    for (    SketchCode code : sketch.getCode()) {
      item=new JMenuItem(code.getPrettyName());
      item.addActionListener(jumpListener);
      menu.add(item);
    }
  }
}

{
  final JavaEditor editor=(JavaEditor)listener;
  boolean launchInteractive=false;
  if (isSketchModified(sketch)) {
    editor.deactivateRun();
    Base.showMessage(Language.text("menu.file.save"),Language.text("tweak_mode.save_before_tweak"));
    return null;
  }
  JavaBuild build=new JavaBuild(sketch);
  String appletClassName=build.build(false);
  if (appletClassName == null) {
    return null;
  }
  editor.initBaseCode();
  boolean requiresTweak=SketchParser.containsTweakComment(editor.baseCode);
  final SketchParser parser=new SketchParser(editor.baseCode,requiresTweak);
  launchInteractive=editor.automateSketch(sketch,parser.allHandles);
  build=new JavaBuild(sketch);
  appletClassName=build.build(false);
  if (appletClassName != null) {
    final Runner runtime=new Runner(build,listener);
    new Thread(new Runnable(){
      public void run(){
        runtime.launch(present);
        editor.initEditorCode(parser.allHandles,false);
        editor.stopInteractiveMode(parser.allHandles);
      }
    }
).start();
    if (launchInteractive) {
      editor.initEditorCode(parser.allHandles,false);
      editor.updateInterface(parser.allHandles,parser.colorBoxes);
      editor.startInteractiveMode();
    }
    return runtime;
  }
  return null;
}

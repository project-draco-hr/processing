{
  if (cvertexIndex == CVERTEX_ALLOC) {
    System.arraycopy(cvertex[CVERTEX_ALLOC - 3],0,cvertex[0],0,VERTEX_FIELD_COUNT);
    System.arraycopy(cvertex[CVERTEX_ALLOC - 2],0,cvertex[1],0,VERTEX_FIELD_COUNT);
    System.arraycopy(cvertex[CVERTEX_ALLOC - 1],0,cvertex[2],0,VERTEX_FIELD_COUNT);
    cvertexIndex=3;
  }
  int savedIndex=cvertexIndex + 1;
  if (cverticesFlat && (z != 0))   cverticesFlat=false;
  setup_vertex(cvertex[cvertexIndex],x,y,z);
  cvertexIndex=savedIndex;
  if (cvertexIndex > 3) {
    if (bezier) {
      if ((cvertexIndex % 4) == 0) {
        if (!bezier_inited)         bezier_init();
        if (cverticesFlat) {
          spline_segment(cvertex[cvertexIndex - 4][MX],cvertex[cvertexIndex - 4][MY],cvertex[cvertexIndex - 3][MX],cvertex[cvertexIndex - 3][MY],cvertex[cvertexIndex - 2][MX],cvertex[cvertexIndex - 2][MY],cvertex[cvertexIndex - 1][MX],cvertex[cvertexIndex - 1][MY],cvertex[cvertexIndex - 4][MX],cvertex[cvertexIndex - 4][MY],bezier_draw,bezier_segments);
        }
 else {
          spline_segment(cvertex[cvertexIndex - 4][MX],cvertex[cvertexIndex - 4][MY],cvertex[cvertexIndex - 4][MZ],cvertex[cvertexIndex - 3][MX],cvertex[cvertexIndex - 3][MY],cvertex[cvertexIndex - 3][MZ],cvertex[cvertexIndex - 2][MX],cvertex[cvertexIndex - 2][MY],cvertex[cvertexIndex - 2][MZ],cvertex[cvertexIndex - 1][MX],cvertex[cvertexIndex - 1][MY],cvertex[cvertexIndex - 1][MZ],cvertex[cvertexIndex - 4][MX],cvertex[cvertexIndex - 4][MY],cvertex[cvertexIndex - 4][MZ],bezier_draw,bezier_segments);
        }
      }
    }
 else {
      if (!curve_inited)       curve_init();
      if (cverticesFlat) {
        spline_segment(cvertex[cvertexIndex - 4][MX],cvertex[cvertexIndex - 4][MY],cvertex[cvertexIndex - 3][MX],cvertex[cvertexIndex - 3][MY],cvertex[cvertexIndex - 2][MX],cvertex[cvertexIndex - 2][MY],cvertex[cvertexIndex - 1][MX],cvertex[cvertexIndex - 1][MY],cvertex[cvertexIndex - 3][MX],cvertex[cvertexIndex - 3][MY],curve_draw,curve_segments);
      }
 else {
        spline_segment(cvertex[cvertexIndex - 4][MX],cvertex[cvertexIndex - 4][MY],cvertex[cvertexIndex - 4][MZ],cvertex[cvertexIndex - 3][MX],cvertex[cvertexIndex - 3][MY],cvertex[cvertexIndex - 3][MZ],cvertex[cvertexIndex - 2][MX],cvertex[cvertexIndex - 2][MY],cvertex[cvertexIndex - 2][MZ],cvertex[cvertexIndex - 1][MX],cvertex[cvertexIndex - 1][MY],cvertex[cvertexIndex - 1][MZ],cvertex[cvertexIndex - 3][MX],cvertex[cvertexIndex - 3][MY],cvertex[cvertexIndex - 3][MZ],curve_draw,curve_segments);
      }
    }
  }
  cvertexIndex=savedIndex;
}

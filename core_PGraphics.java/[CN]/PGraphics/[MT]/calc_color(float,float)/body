{
  if (gray > colorMaxX)   gray=colorMaxX;
  if (alpha > colorMaxA)   alpha=colorMaxA;
  if (gray < 0)   gray=0;
  if (alpha < 0)   alpha=0;
  calcR=color_scale ? (gray / colorMaxX) : gray;
  calcG=calcR;
  calcB=calcR;
  calcA=color_scale ? (alpha / colorMaxA) : alpha;
  calcRi=(int)(calcR * 255);
  calcGi=(int)(calcG * 255);
  calcBi=(int)(calcB * 255);
  calcAi=(int)(calcA * 255);
  calci=(calcAi << 24) | (calcRi << 16) | (calcGi << 8)| calcBi;
  calc_alpha=(calcAi != 255);
}

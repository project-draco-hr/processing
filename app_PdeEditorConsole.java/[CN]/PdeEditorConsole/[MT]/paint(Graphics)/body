{
  if (bgColor == null) {
    bgColor=PdeBase.getColor("editor.console.bgcolor",new Color(26,26,26));
    fgColorOut=PdeBase.getColor("editor.console.fgcolor.output",new Color(153,153,153));
    fgColorErr=PdeBase.getColor("editor.console.fgcolor.error",new Color(204,51,0));
    scrollEnabledColor=PdeBase.getColor("editor.console.scrollbox.color.enabled",new Color(51,51,51));
    scrollDisabledColor=PdeBase.getColor("editor.console.scrollbox.color.disabled",new Color(35,35,35));
    screen.setFont(font);
    metrics=screen.getFontMetrics();
    ascent=metrics.getAscent();
    leading=ascent + metrics.getDescent();
  }
  Dimension size=getSize();
  if ((size.width != sizeW) || (size.height != sizeH)) {
    if ((size.width > imageW) || (size.height > imageH)) {
      offscreen=null;
    }
 else {
      sizeW=size.width;
      sizeH=size.height;
    }
  }
  if (offscreen == null) {
    sizeW=size.width;
    sizeH=size.height;
    imageW=sizeW;
    imageH=sizeH;
    offscreen=createImage(imageW,imageH);
  }
  if (offscreen == null)   return;
  Graphics g=offscreen.getGraphics();
  g.setFont(font);
  g.setColor(bgColor);
  g.fillRect(0,0,imageW,imageH);
  for (int i=0; i < lineCount; i++) {
    int ii=(firstLine + i) + scrollOffset;
    while (ii < 0)     ii+=maxLineCount;
    if (ii >= maxLineCount)     ii=ii % maxLineCount;
    g.setColor(isError[ii] ? fgColorErr : fgColorOut);
    g.drawString(lines[ii],HINSET,VINSET + ascent + i * ascent);
  }
  final int SCROLL_INSET=4;
  final int SCROLL_SIZE=12;
  scrollRight=sizeW - SCROLL_INSET;
  scrollLeft=scrollRight - SCROLL_SIZE;
  scrollUpTop=SCROLL_INSET;
  scrollUpBottom=scrollUpTop + SCROLL_SIZE;
  scrollDownBottom=sizeH - SCROLL_INSET;
  scrollDownTop=scrollDownBottom - SCROLL_SIZE;
  g.setColor(scrollEnabledColor);
  g.fillRect(scrollLeft,scrollUpTop,SCROLL_SIZE,SCROLL_SIZE);
  g.setColor((scrollOffset != 0) ? scrollEnabledColor : scrollDisabledColor);
  g.fillRect(scrollLeft,scrollDownTop,SCROLL_SIZE,SCROLL_SIZE);
  screen.drawImage(offscreen,0,0,null);
}

{
  String foundName=build(true);
  if (foundName == null)   return false;
  if (!sketch.getName().equals(foundName)) {
    Messages.showWarning("Error during export","Sketch name is " + sketch.getName() + " but the sketch\n"+ "name in the code was "+ foundName,null);
    return false;
  }
  File folder=null;
  for (  String platformName : PConstants.platformNames) {
    int platform=Platform.getIndex(platformName);
    boolean embedJava=(platform == PApplet.platform) && Preferences.getBoolean("export.application.embed_java");
    if (Preferences.getBoolean(JavaEditor.EXPORT_PREFIX + platformName)) {
      if (Library.hasMultipleArch(platform,importedLibraries)) {
        folder=new File(sketch.getFolder(),"application." + platformName + "32");
        if (!exportApplication(folder,platform,"32",embedJava && Platform.getNativeBits() == 32 && "x86".equals(Platform.getNativeArch()))) {
          return false;
        }
        folder=new File(sketch.getFolder(),"application." + platformName + "64");
        if (!exportApplication(folder,platform,"64",embedJava && Platform.getNativeBits() == 64 && "amd64".equals(Platform.getNativeArch()))) {
          return false;
        }
        if (platform == PConstants.LINUX) {
          folder=new File(sketch.getFolder(),"application.linux-armv6hf");
          if (!exportApplication(folder,platform,"armv6hf",embedJava && Platform.getNativeBits() == 32 && "arm".equals(Platform.getNativeArch()))) {
            return false;
          }
        }
      }
 else {
        folder=new File(sketch.getFolder(),"application." + platformName);
        if (!exportApplication(folder,platform,"",embedJava)) {
          return false;
        }
      }
    }
  }
  return true;
}

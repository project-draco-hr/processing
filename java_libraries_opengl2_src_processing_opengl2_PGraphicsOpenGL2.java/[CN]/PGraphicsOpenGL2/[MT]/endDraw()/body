{
  report("top endDraw()");
  gl.glViewport(viewport[0],viewport[1],viewport[2],viewport[3]);
  if (USE_GEO_BUFFER) {
    if (GEO_BUFFER_ACCUM_ALL && geoBuffer != null && 0 < geoBuffer.vertCount) {
      geoBuffer.pre();
      geoBuffer.render();
      geoBuffer.post();
    }
  }
  if (hints[ENABLE_DEPTH_SORT]) {
    flush();
  }
  if (primarySurface) {
    gl.glFlush();
    if (drawable != null) {
      drawable.swapBuffers();
      releaseContext();
    }
  }
 else {
    if (offscreenMultisample) {
      offscreenFramebufferMultisample.copy(offscreenFramebuffer);
    }
    popFramebuffer();
    ogl.restoreGLState();
  }
  report("bot endDraw()");
}

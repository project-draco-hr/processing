{
  String newName=txtRenameField.getText().trim();
  String selText=lastClickedWord == null ? editor.ta.getSelectedText() : lastClickedWord;
  DefaultMutableTreeNode defCU=findAllOccurrences();
  if (defCU == null) {
    editor.statusMessage("Can't locate definition of " + selText,DebugEditor.STATUS_ERR);
    return;
  }
  if (!newName.matches("([a-zA-Z][a-zA-Z0-9_]*)|([_][a-zA-Z0-9_]+)")) {
    JOptionPane.showConfirmDialog(new JFrame(),newName + " isn't a valid name.","Uh oh..",JOptionPane.PLAIN_MESSAGE);
    return;
  }
  errorCheckerService.pauseThread();
  if (treeRename.isVisible()) {
    treeRename.setModel(new DefaultTreeModel(defCU));
    ((DefaultTreeModel)treeRename.getModel()).reload();
  }
  frmOccurenceList.setTitle("Usage of " + selText);
  frmOccurenceList.setLocation(editor.getX() + editor.getWidth(),editor.getY());
  frmOccurenceList.setVisible(true);
  int lineOffsetDisplacementConst=newName.length() - selText.length();
  HashMap<Integer,Integer> lineOffsetDisplacement=new HashMap<Integer,Integer>();
  int offsetsMap[][][]=new int[defCU.getChildCount()][2][];
  for (int i=0; i < defCU.getChildCount(); i++) {
    ASTNodeWrapper awrap=(ASTNodeWrapper)((DefaultMutableTreeNode)(defCU.getChildAt(i))).getUserObject();
    offsetsMap[i][0]=awrap.getPDECodeOffsets(errorCheckerService);
    offsetsMap[i][1]=awrap.getJavaCodeOffsets(errorCheckerService);
    log(getNodeAsString(awrap.getNode()) + ", " + awrap.getPDECodeOffsetForSN(this));
  }
  errorCheckerService.resumeThread();
  editor.getSketch().setModified(true);
  errorCheckerService.runManualErrorCheck();
  frmOccurenceList.setVisible(false);
  frmRename.setVisible(false);
  lastClickedWord=null;
  lastClickedWordNode=null;
}

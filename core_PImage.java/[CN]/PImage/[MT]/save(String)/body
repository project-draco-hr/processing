{
  boolean success=false;
  try {
    OutputStream os=null;
    if (filename.toLowerCase().endsWith(".tga")) {
      os=new BufferedOutputStream(new FileOutputStream(filename),32768);
      success=saveTGA(os,pixels,width,height,format);
    }
 else {
      if (!filename.toLowerCase().endsWith(".tif") && !filename.toLowerCase().endsWith(".tiff")) {
        filename+=".tif";
      }
      os=new BufferedOutputStream(new FileOutputStream(filename),32768);
      success=saveTIFF(os,pixels,width,height);
    }
    os.flush();
    os.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
    success=false;
  }
  if (!success) {
    throw new RuntimeException("Error while saving image.");
  }
}

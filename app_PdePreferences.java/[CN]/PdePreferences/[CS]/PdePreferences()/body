{
  properties=new Properties();
  String home=System.getProperty("user.home");
  preferencesFile=new File(home,".processing");
  if (!preferencesFile.exists()) {
    try {
      if ((PdeBase.platform == PdeBase.MACOSX) || (PdeBase.platform == PdeBase.MACOS9)) {
        load(new FileInputStream("lib/pde.properties"));
      }
 else {
        load(getClass().getResource("pde.properties").openStream());
      }
    }
 catch (    Exception e) {
      showError(null,"Could not read default settings.\n" + "You'll need to reinstall Processing.",e);
      System.exit(1);
    }
    firstTime=true;
  }
 else {
    try {
      load(new FileInputStream(preferencesFile));
    }
 catch (    Exception e) {
      showError("Error reading preferences","Error reading the preferences file. Please delete\n" + perferencesFile.getCanonicalPath() + "\n"+ "and restart Processing.",e);
    }
  }
  String platformExtension="." + PdeBase.platforms[PdeBase.platform];
  int extensionLength=platformExtension.length();
  Enumeration e=properties.propertyNames();
  while (e.hasMoreElements()) {
    String key=(String)e.nextElement();
    if (key.endsWith(platformExtension)) {
      String actualKey=key.substring(0,key.length() - extensionLength);
      String value=get(key);
      System.out.println("found platform specific prop \"" + actualKey + "\" \""+ value+ "\"");
      properties.put(actualKey,value);
      System.out.println("now set to " + table.get(actualKey));
    }
  }
  frame=new JFrame("Preferences");
  frame.setResizable(false);
  Container pain=this;
  pain.setLayout(null);
  int top=BIG;
  int left=BIG;
  int right=0;
  JLabel label;
  JButton button;
  JComboBox combo;
  Dimension d, d2, d3;
  int h, v, vmax;
  newSketchPromptBox=new JCheckBox("Prompt for name when creating a new sketch");
  pain.add(newSketchPromptBox);
  d=newSketchPromptBox.getPreferredSize();
  newSketchPromptBox.setBounds(left,top,d.width,d.height);
  right=Math.max(right,left + d.width);
  top+=d.height + BETWEEN;
  label=new JLabel("Sketchbook location:");
  pain.add(label);
  d=label.getPreferredSize();
  sketchbookLocationField=new JTextField(18);
  pain.add(sketchbookLocationField);
  d2=sketchbookLocationField.getPreferredSize();
  button=new JButton("Browse");
  pain.add(button);
  d3=button.getPreferredSize();
  vmax=Math.max(Math.max(d.height,d2.height),d3.height);
  label.setBounds(left,top + (vmax - d.height) / 2,d.width,d.height);
  h=left + d.width + BETWEEN;
  sketchbookLocation.setBounds(h,top + (vmax - d2.height) / 2,d2.width,d2.height);
  h+=d2.width + BETWEEN;
  button.setBounds(h,top + (vmax - d3.height) / 2,d3.width,d3.height);
  right=Math.max(right,h + d3.width + BIG);
  top+=vmax + BETWEEN;
  externalEditorBox=new JCheckBox("Use external editor");
  pain.add(externalEditorBox);
  d=externalEditorBox.getPreferredSize();
  externalEditorBox.setBounds(left,top,d.width,d.height);
  right=Math.max(right,left + d.width);
  top+=d.height + BETWEEN;
  String blather="More preferences are in the 'lib' folder inside text files\n" + "named pde.properties and pde_" + PdeBase.platforms[PdeBase.platform] + ".properties";
  JTextArea textarea=new JTextArea(blather);
  textarea.setBorder(new EmptyBorder(SMALL,SMALL,SMALL,SMALL));
  textarea.setFont(new Font("Dialog",Font.PLAIN,12));
  pain.add(textarea);
  d=textarea.getPreferredSize();
  textarea.setBounds(left,top,d.width,d.height);
  top+=d.height + BETWEEN;
  wide=right + BIG;
  high=top + BIG;
  setSize(wide,high);
  Container content=frame.getContentPane();
  content.setLayout(new BorderLayout());
  content.add(this,BorderLayout.CENTER);
  frame.pack();
  Dimension screen=Toolkit.getDefaultToolkit().getScreenSize();
  frame.setLocation((screen.width - wide) / 2,(screen.height - high) / 2);
  frame.addWindowListener(new WindowAdapter(){
    public void windowClosing(    WindowEvent e){
      frame.hide();
    }
  }
);
}

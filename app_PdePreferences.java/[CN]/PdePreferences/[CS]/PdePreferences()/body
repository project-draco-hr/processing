{
  try {
    load(PdeBase.getStream("pde.properties"));
  }
 catch (  Exception e) {
    PdeBase.showError(null,"Could not read default settings.\n" + "You'll need to reinstall Processing.",e);
  }
  String platformExtension="." + PdeBase.platforms[PdeBase.platform];
  int extensionLength=platformExtension.length();
  Enumeration e=table.keys();
  while (e.hasMoreElements()) {
    String key=(String)e.nextElement();
    if (key.endsWith(platformExtension)) {
      String actualKey=key.substring(0,key.length() - extensionLength);
      String value=get(key);
      System.out.println("found platform specific prop \"" + actualKey + "\" \""+ value+ "\"");
      table.put(actualKey,value);
      System.out.println("now set to " + table.get(actualKey));
    }
  }
  setColor("run.window.bgcolor",SystemColor.control);
  String home=System.getProperty("user.home");
  preferencesFile=new File(home,".processing");
  if (!preferencesFile.exists()) {
    File sketchbookDir=new File(home,"sketchbook");
    set("sketchbook.path",sketchbookDir.getAbsolutePath());
    save();
  }
 else {
    try {
      load(new FileInputStream(preferencesFile));
    }
 catch (    Exception ex) {
      PdeBase.showError("Error reading preferences","Error reading the preferences file. " + "Please delete (or move)\n" + preferencesFile.getAbsolutePath() + " and restart Processing.",ex);
    }
  }
  frame=new JFrame("Preferences");
  frame.setResizable(false);
  Container pain=this;
  pain.setLayout(null);
  int top=GUI_BIG;
  int left=GUI_BIG;
  int right=0;
  JLabel label;
  JButton button, button2;
  JComboBox combo;
  Dimension d, d2, d3;
  int h, v, vmax;
  sketchPromptBox=new JCheckBox("Prompt for name when opening or creating a sketch");
  pain.add(sketchPromptBox);
  d=sketchPromptBox.getPreferredSize();
  sketchPromptBox.setBounds(left,top,d.width,d.height);
  right=Math.max(right,left + d.width);
  top+=d.height + GUI_BETWEEN;
  label=new JLabel("Sketchbook location:");
  pain.add(label);
  d=label.getPreferredSize();
  sketchbookLocationField=new JTextField(18);
  pain.add(sketchbookLocationField);
  d2=sketchbookLocationField.getPreferredSize();
  button=new JButton(PROMPT_BROWSE);
  button.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      JFileChooser fc=new JFileChooser();
      fc.setSelectedFile(new File(sketchbookLocationField.getText()));
      fc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
      int returned=fc.showOpenDialog(new JDialog());
      if (returned == JFileChooser.APPROVE_OPTION) {
        File file=fc.getSelectedFile();
        sketchbookLocationField.setText(file.getAbsolutePath());
      }
    }
  }
);
  pain.add(button);
  d3=button.getPreferredSize();
  vmax=Math.max(Math.max(d.height,d2.height),d3.height);
  label.setBounds(left,top + (vmax - d.height) / 2,d.width,d.height);
  h=left + d.width + GUI_BETWEEN;
  sketchbookLocationField.setBounds(h,top + (vmax - d2.height) / 2,d2.width,d2.height);
  h+=d2.width + GUI_BETWEEN;
  button.setBounds(h,top + (vmax - d3.height) / 2,d3.width,d3.height);
  right=Math.max(right,h + d3.width + GUI_BIG);
  top+=vmax + GUI_BETWEEN;
  exportLibraryBox=new JCheckBox("Enable export to \"Library\"");
  pain.add(exportLibraryBox);
  d=exportLibraryBox.getPreferredSize();
  exportLibraryBox.setBounds(left,top,d.width,d.height);
  right=Math.max(right,left + d.width);
  top+=d.height + GUI_BETWEEN;
  externalEditorBox=new JCheckBox("Use external editor");
  pain.add(externalEditorBox);
  d=externalEditorBox.getPreferredSize();
  externalEditorBox.setBounds(left,top,d.width,d.height);
  right=Math.max(right,left + d.width);
  top+=d.height + GUI_BETWEEN;
  String blather="More preferences are in the 'lib' folder inside text files\n" + "named pde.properties and pde_" + PdeBase.platforms[PdeBase.platform] + ".properties";
  JTextArea textarea=new JTextArea(blather);
  textarea.setBorder(new EmptyBorder(GUI_SMALL,GUI_SMALL,GUI_SMALL,GUI_SMALL));
  textarea.setFont(new Font("Dialog",Font.PLAIN,12));
  pain.add(textarea);
  d=textarea.getPreferredSize();
  textarea.setBounds(left,top,d.width,d.height);
  top+=d.height + GUI_BETWEEN;
  button=new JButton(PROMPT_OK);
  button.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      applyFrame();
      disposeFrame();
    }
  }
);
  pain.add(button);
  button.setBounds(left,top,BUTTON_WIDTH,BUTTON_HEIGHT);
  h=left + BUTTON_WIDTH + GUI_BETWEEN;
  button=new JButton(PROMPT_CANCEL);
  button.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      disposeFrame();
    }
  }
);
  pain.add(button);
  button.setBounds(h,top,BUTTON_WIDTH,BUTTON_HEIGHT);
  top+=BUTTON_HEIGHT + GUI_BETWEEN;
  wide=right + GUI_BIG;
  high=top + GUI_BIG;
  setSize(wide,high);
  Container content=frame.getContentPane();
  content.setLayout(new BorderLayout());
  content.add(this,BorderLayout.CENTER);
  frame.pack();
  Dimension screen=Toolkit.getDefaultToolkit().getScreenSize();
  frame.setLocation((screen.width - wide) / 2,(screen.height - high) / 2);
}

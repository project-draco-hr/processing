{
  tweakClient.shutdown();
  getJavaTextArea().stopInteractiveMode();
  removeSpacesFromCode();
  boolean modified=false;
  boolean[] modifiedTabs=getModifiedTabs(handles);
  for (  boolean mod : modifiedTabs) {
    if (mod) {
      modified=true;
      break;
    }
  }
  if (modified) {
    int ret=Base.showYesNoQuestion(this,Language.text("tweak_mode"),Language.text("tweak_mode.keep_changes.line1"),Language.text("tweak_mode.keep_changes.line2"));
    if (ret == 1) {
      loadSavedCode();
      textarea.invalidate();
    }
 else {
      for (int i=0; i < sketch.getCodeCount(); i++) {
        if (modifiedTabs[i]) {
          sketch.getCode(i).setModified(true);
        }
 else {
          sketch.getCode(i).setProgram(sketch.getCode(i).getSavedProgram());
          sketch.getCode(i).setDocument(null);
          if (i == sketch.getCurrentCodeIndex()) {
            setCode(sketch.getCurrentCode());
          }
        }
      }
      try {
        sketch.save();
      }
 catch (      IOException e) {
        Base.showWarning("Tweak Mode","Could not save the modified sketch!",e);
      }
      header.repaint();
      textarea.invalidate();
    }
  }
 else {
    loadSavedCode();
    textarea.invalidate();
  }
}

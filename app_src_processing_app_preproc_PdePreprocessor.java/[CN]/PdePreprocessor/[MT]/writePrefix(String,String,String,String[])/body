{
  this.buildPath=buildPath;
  this.name=sketchName;
  foundMain=false;
  program+="\n";
  String scrubbed=Sketch.scrubComments(program);
  if (Preferences.getBoolean("preproc.substitute_unicode")) {
    program=substituteUnicode(program);
  }
  String importRegexp="(?:^|;)\\s*(import\\s+)(\\S+)(\\s*;)";
  programImports=new ArrayList<String>();
  do {
    String[] pieces=PApplet.match(scrubbed,importRegexp);
    if (pieces == null)     break;
    String piece=pieces[1] + pieces[2] + pieces[3];
    int len=piece.length();
    programImports.add(pieces[2]);
    int idx=scrubbed.indexOf(piece);
    program=program.substring(0,idx) + program.substring(idx + len);
    scrubbed=scrubbed.substring(0,idx) + scrubbed.substring(idx + len);
  }
 while (true);
  codeFolderImports=new ArrayList<String>();
  if (codeFolderPackages != null) {
    for (    String item : codeFolderPackages) {
      codeFolderImports.add(item + ".*");
    }
  }
  this.programReader=new StringReader(program);
  File streamFile=new File(buildPath,sketchName + ".java");
  stream=new PrintStream(new FileOutputStream(streamFile));
  int importsLength=writeImports(stream);
  return importsLength + 2;
}

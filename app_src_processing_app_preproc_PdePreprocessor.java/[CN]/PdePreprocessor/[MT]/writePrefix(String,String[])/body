{
  foundMain=false;
  checkForUnterminatedMultilineComment(program);
  if (Preferences.getBoolean("preproc.substitute_unicode")) {
    program=substituteUnicode(program);
  }
  final String importRegexp="(?:^|;)\\s*(import\\s+)((?:static\\s+)?\\S+)(\\s*;)";
  programImports=new ArrayList<String>();
  do {
    String[] pieces=PApplet.match(program,importRegexp);
    if (pieces == null)     break;
    String piece=pieces[1] + pieces[2] + pieces[3];
    int len=piece.length();
    programImports.add(pieces[2]);
    int idx=program.indexOf(piece);
    program=program.substring(0,idx) + program.substring(idx + len);
  }
 while (true);
  codeFolderImports=new ArrayList<String>();
  if (codeFolderPackages != null) {
    for (    String item : codeFolderPackages) {
      codeFolderImports.add(item + ".*");
    }
  }
  this.programReader=new StringReader(program);
  int importsLength=writeImports(stream);
  return importsLength + 2;
}

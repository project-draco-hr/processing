{
  Insets insets=frame.getInsets();
  int windowW=Math.max(sketch.width,MIN_WINDOW_WIDTH) + insets.left + insets.right;
  int windowH=Math.max(sketch.height,MIN_WINDOW_HEIGHT) + insets.top + insets.bottom;
  int contentW=Math.max(sketch.width,MIN_WINDOW_WIDTH);
  int contentH=Math.max(sketch.height,MIN_WINDOW_HEIGHT);
  frame.setSize(windowW,windowH);
  if (location != null) {
    frame.setLocation(location[0],location[1]);
  }
 else   if (external && editorLocation != null) {
    int locationX=editorLocation[0] - 20;
    int locationY=editorLocation[1];
    if (locationX - windowW > 10) {
      frame.setLocation(locationX - windowW,locationY);
    }
 else {
      locationX=editorLocation[0] + 66;
      locationY=editorLocation[1] + 66;
      if ((locationX + windowW > sketch.displayWidth - 33) || (locationY + windowH > sketch.displayHeight - 33)) {
        locationX=(sketch.displayWidth - windowW) / 2;
        locationY=(sketch.displayHeight - windowH) / 2;
      }
      frame.setLocation(locationX,locationY);
    }
  }
 else {
    frame.setLocation(screenRect.x + (screenRect.width - sketch.width) / 2,screenRect.y + (screenRect.height - sketch.height) / 2);
  }
  Point frameLoc=frame.getLocation();
  if (frameLoc.y < 0) {
    frame.setLocation(frameLoc.x,30);
  }
  if (backgroundColor != null) {
    ((JFrame)frame).getContentPane().setBackground(backgroundColor);
  }
  canvas.setBounds((contentW - sketch.width) / 2,(contentH - sketch.height) / 2,sketch.width,sketch.height);
  if (!external) {
    frame.addWindowListener(new WindowAdapter(){
      @Override public void windowClosing(      java.awt.event.WindowEvent e){
        System.exit(0);
      }
    }
);
  }
  setupFrameResizeListener();
  if (sketch.displayable()) {
    frame.setVisible(true);
    if (PApplet.platform == PConstants.LINUX) {
      Insets irlInsets=frame.getInsets();
      if (!irlInsets.equals(insets)) {
        insets=irlInsets;
        windowW=Math.max(sketch.width,MIN_WINDOW_WIDTH) + insets.left + insets.right;
        windowH=Math.max(sketch.height,MIN_WINDOW_HEIGHT) + insets.top + insets.bottom;
        frame.setSize(windowW,windowH);
      }
    }
  }
}

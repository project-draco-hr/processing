{
  GraphicsEnvironment environment=GraphicsEnvironment.getLocalGraphicsEnvironment();
  GraphicsDevice devices[]=environment.getScreenDevices();
  if ((deviceIndex >= 0) && (deviceIndex < devices.length)) {
    displayDevice=devices[deviceIndex];
  }
 else {
    System.err.println("Display " + deviceIndex + " does not exist, "+ "using the default display instead.");
    for (int i=0; i < devices.length; i++) {
      System.err.println("Display " + i + " is "+ devices[i]);
    }
  }
  if (displayDevice == null) {
    displayDevice=environment.getDefaultScreenDevice();
  }
  screenRect=spanDisplays ? getDisplaySpan() : displayDevice.getDefaultConfiguration().getBounds();
  sketch.displayWidth=screenRect.width;
  sketch.displayHeight=screenRect.height;
  if (screenRect.width == sketch.sketchWidth() && screenRect.height == sketch.sketchHeight()) {
    fullScreen=true;
  }
  frame=new JFrame(displayDevice.getDefaultConfiguration());
  ((JFrame)frame).getContentPane().setBackground(WINDOW_BGCOLOR);
  setIconImage(frame);
  if (fullScreen) {
    PApplet.hideMenuBar();
    frame.setUndecorated(true);
    if (backgroundColor != null) {
      ((JFrame)frame).getContentPane().setBackground(backgroundColor);
    }
    frame.setBounds(screenRect);
    frame.setVisible(true);
  }
  frame.setLayout(null);
  frame.add(applet);
  if (fullScreen) {
    frame.invalidate();
  }
 else {
    frame.pack();
  }
  frame.setResizable(false);
  return frame;
}

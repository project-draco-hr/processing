{
  AndroidDevice emu=find(true);
  if (emu != null) {
    return emu;
  }
  final EmulatorController emuController=EmulatorController.getInstance();
  final State currentState=emuController.getState();
  if (currentState == State.NOT_RUNNING) {
    try {
      emuController.launch();
    }
 catch (    final IOException e) {
      e.printStackTrace(System.err);
      return null;
    }
  }
 else   if (currentState == State.WAITING_FOR_BOOT) {
    System.err.println("Emulator has already been launched. I'll wait.");
  }
 else   if (currentState == State.RUNNING) {
    System.err.println("That's weird. The emulator process seems to be running, but I don't know about it.");
  }
  while (!Thread.currentThread().isInterrupted()) {
    if (emuController.getState() == State.NOT_RUNNING) {
      System.err.println("Ouch. Emulator got killed, I think.");
      return null;
    }
    emu=find(true);
    if (emu != null) {
      return emu;
    }
    try {
      Thread.sleep(2000);
    }
 catch (    final InterruptedException e) {
      System.err.println("AndroidEnvironment: interrupted in loop.");
      return null;
    }
  }
  return null;
}

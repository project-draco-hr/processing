{
  if (args.length < 1) {
    System.err.println("error: PApplet <appletname>");
    System.exit(1);
  }
  try {
    boolean external=false;
    int location[]=null;
    boolean exactLocation=false;
    String folder=System.getProperty("user.dir");
    String name=null;
    int argIndex=0;
    while (argIndex < args.length) {
      if (args[argIndex].indexOf(EXT_LOCATION) == 0) {
        external=true;
        String locationStr=args[argIndex].substring(EXT_LOCATION.length());
        location=toInt(split(locationStr,','));
      }
 else       if (args[argIndex].indexOf(EXT_EXACT_LOCATION) == 0) {
        external=true;
        String locationStr=args[argIndex].substring(EXT_LOCATION.length());
        location=toInt(split(locationStr,','));
        exactLocation=true;
      }
 else       if (args[argIndex].indexOf(EXT_SKETCH_FOLDER) == 0) {
        folder=args[argIndex].substring(EXT_SKETCH_FOLDER.length());
      }
 else {
        name=args[argIndex];
        break;
      }
    }
    Frame frame=new Frame();
    frame.pack();
    Class c=Class.forName(name);
    PApplet applet=(PApplet)c.newInstance();
    applet.folder=folder;
    int argc=args.length - argIndex;
    applet.args=new String[argc];
    System.arraycopy(args,argc,applet.args,0,argc);
    applet.init();
    applet.start();
    Dimension screen=Toolkit.getDefaultToolkit().getScreenSize();
    if (external) {
      Insets insets=frame.getInsets();
      int locationX=location[0] - 20;
      int locationY=location[1];
      int minW=120;
      int minH=120;
      int windowW=Math.max(applet.width,minW) + insets.left + insets.right;
      int windowH=Math.max(applet.height,minH) + insets.top + insets.bottom;
      frame.setSize(windowW,windowH);
      if (exactLocation) {
        frame.setLocation(location[0],location[1]);
      }
 else {
        if (locationX - windowW > 10) {
          frame.setLocation(locationX - windowW,locationY);
        }
 else {
          locationX=location[0] + 66;
          locationY=location[1] + 66;
          if ((locationX + windowW > screen.width - 33) || (locationY + windowH > screen.height - 33)) {
            locationX=(screen.width - windowW) / 2;
            locationY=(screen.height - windowH) / 2;
          }
          frame.setLocation(locationX,locationY);
        }
      }
      frame.setLayout(null);
      frame.add(applet);
      frame.setBackground(SystemColor.control);
      applet.setBounds((windowW - applet.width) / 2,insets.top + ((windowH - insets.top - insets.bottom) - applet.height) / 2,windowW,windowH);
      applet.setupExternal(frame);
    }
 else {
      applet.args=new String[args.length - 1];
      System.arraycopy(args,1,applet.args,0,args.length - 1);
      frame.setLayout(new BorderLayout());
      frame.add(applet,BorderLayout.CENTER);
      frame.pack();
      frame.setLocation((screen.width - applet.g.width) / 2,(screen.height - applet.g.height) / 2);
      frame.addWindowListener(new WindowAdapter(){
        public void windowClosing(        WindowEvent e){
          System.exit(0);
        }
      }
);
    }
    frame.show();
    applet.requestFocus();
  }
 catch (  Exception e) {
    e.printStackTrace();
    System.exit(1);
  }
}

{
  Image awtImage=Toolkit.getDefaultToolkit().createImage(loadBytes(filename));
  MediaTracker tracker=new MediaTracker(this);
  tracker.addImage(awtImage,0);
  try {
    tracker.waitForAll();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  PImage image=new PImage(awtImage);
  if (filename.toLowerCase().endsWith(".gif")) {
    for (int i=0; i < image.pixels.length; i++) {
      if ((image.pixels[i] & 0xff000000) != 0xff000000) {
        image.format=ARGB;
      }
    }
  }
  return image;
}

{
  try {
    while ((Thread.currentThread() == thread) && !finished) {
      if (PApplet.THREAD_DEBUG)       println(Thread.currentThread().getName() + " formerly nextFrame()");
      if (looping || redraw) {
        if (fpsTarget != 0)         framerate_delay();
        if (frameCount == 0) {
          createGraphics();
        }
synchronized (g) {
          if (THREAD_DEBUG)           println(Thread.currentThread().getName() + " 1a beginFrame");
          g.beginFrame();
          if (THREAD_DEBUG)           println(Thread.currentThread().getName() + " 1b draw");
          if (frameCount == 0) {
            defaults();
            setup();
            this.pixels=g.pixels;
            this.width=g.width;
            this.height=g.height;
          }
 else {
            preMethods.handle();
            pmouseX=dmouseX;
            pmouseY=dmouseY;
            draw();
            dequeueMouseEvents();
            dmouseX=mouseX;
            dmouseY=mouseY;
            dequeueKeyEvents();
            if (THREAD_DEBUG)             println(Thread.currentThread().getName() + " 2b endFrame");
            drawMethods.handle();
          }
          g.endFrame();
          frameCount++;
          if (THREAD_DEBUG)           println(Thread.currentThread().getName() + "   3a calling repaint() " + frameCount);
          repaint();
          if (THREAD_DEBUG)           println(Thread.currentThread().getName() + "   3b calling Toolkit.sync " + frameCount);
          getToolkit().sync();
          if (THREAD_DEBUG)           println(Thread.currentThread().getName() + "   3c done " + frameCount);
          postMethods.handle();
        }
      }
      redraw=false;
      try {
        if (THREAD_DEBUG)         println(Thread.currentThread().getName() + " " + looping+ " "+ redraw);
        if (THREAD_DEBUG)         println(Thread.currentThread().getName() + " gonna sleep");
        Thread.sleep(looping ? 1 : 10000);
        if (THREAD_DEBUG)         println(Thread.currentThread().getName() + " outta sleep");
      }
 catch (      InterruptedException e) {
      }
    }
  }
 catch (  Exception e) {
    finished=true;
    if (leechErr != null) {
      leechErr.println(LEECH_WAKEUP);
      e.printStackTrace(leechErr);
    }
 else {
      System.err.println(LEECH_WAKEUP);
      e.printStackTrace();
    }
  }
  if (THREAD_DEBUG)   println(Thread.currentThread().getName() + " thread finished");
  stop();
}

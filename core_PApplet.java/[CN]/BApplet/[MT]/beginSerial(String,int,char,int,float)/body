{
  if (serialPort != null)   serialPort.close();
  int parity=SerialPort.PARITY_NONE;
  if (iparity == 'E')   parity=SerialPort.PARITY_EVEN;
  if (iparity == 'O')   parity=SerialPort.PARITY_ODD;
  int stopbits=SerialPort.STOPBITS_1;
  if (istopbits == 1.5f)   stopbits=SerialPort.STOPBITS_1_5;
  if (istopbits == 2)   stopbits=SerialPort.STOPBITS_2;
  try {
    Enumeration portList=CommPortIdentifier.getPortIdentifiers();
    while (portList.hasMoreElements()) {
      CommPortIdentifier portId=(CommPortIdentifier)portList.nextElement();
      if (portId.getPortType() == CommPortIdentifier.PORT_SERIAL) {
        if (portId.getName().equals(port)) {
          serialPort=(SerialPort)portId.open("bagel applet serial",2000);
          serialInput=serialPort.getInputStream();
          serialOutput=serialPort.getOutputStream();
          serialPort.setSerialPortParams(rate,databits,stopbits,parity);
          serialPort.addEventListener(this);
          serialPort.notifyOnDataAvailable(true);
        }
      }
    }
  }
 catch (  Exception e) {
    exception=e;
    e.printStackTrace();
    serialPort=null;
    serialInput=null;
    serialOutput=null;
  }
}

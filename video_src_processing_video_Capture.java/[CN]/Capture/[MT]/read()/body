{
  beginPixels();
synchronized (pixels) {
    if (crop) {
      if (data == null) {
        data=new int[dataWidth * dataHeight];
      }
      raw.copyToArray(0,data,0,dataWidth * dataHeight);
      int sourceOffset=cropX + cropY * dataWidth;
      int destOffset=0;
      for (int y=0; y < cropH; y++) {
        System.arraycopy(data,sourceOffset,pixels,destOffset,cropW);
        sourceOffset+=dataWidth;
        destOffset+=width;
      }
    }
 else {
      raw.copyToArray(0,pixels,0,width * height);
    }
    available=false;
    endPixels();
  }
}

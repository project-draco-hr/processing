{
  System.err.println("Waiting until " + device + " is ready.");
  final long timeout=System.currentTimeMillis() + 30 * 1000;
  try {
    while (System.currentTimeMillis() < timeout) {
      final ProcessHelper p=new ProcessHelper("adb","-s",device,"jdwp");
      final ProcessResult jdwpResult=p.execute();
      if (jdwpResult.succeeded()) {
        System.err.println(device + " is seemingly ready.");
        return true;
      }
      if (!jdwpResult.getStderr().contains("device offline")) {
        System.err.println(jdwpResult);
      }
      Thread.sleep(1000);
    }
  }
 catch (  final InterruptedException e) {
    System.err.println("waitUntilReady interrupted");
  }
catch (  final Exception e) {
    e.printStackTrace();
  }
  System.err.println("Timed out waiting for " + device + ".");
  return false;
}

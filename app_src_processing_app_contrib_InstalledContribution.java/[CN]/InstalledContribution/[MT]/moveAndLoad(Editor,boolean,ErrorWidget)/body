{
  ArrayList<InstalledContribution> oldContribs=ContributionManager.listContributions(getType(),editor);
  String contribFolderName=getFolder().getName();
  File contribTypeFolder=getType().getSketchbookFolder();
  File contribFolder=new File(contribTypeFolder,contribFolderName);
  for (  InstalledContribution oldContrib : oldContribs) {
    if ((oldContrib.getFolder().exists() && oldContrib.getFolder().equals(contribFolder)) || (oldContrib.getId() != null && oldContrib.getId().equals(getId()))) {
      if (ContributionManager.requiresRestart(oldContrib)) {
        if (!oldContrib.backupContribution(editor,false,statusBar)) {
          return null;
        }
      }
 else {
        int result=0;
        boolean doBackup=Preferences.getBoolean("contribution.backup.on_install");
        if (confirmReplace) {
          if (doBackup) {
            result=Base.showYesNoQuestion(editor,"Replace","Replace pre-existing \"" + oldContrib.getName() + "\" library?","A pre-existing copy of the \"" + oldContrib.getName() + "\" library<br>"+ "has been found in your sketchbook. Clicking ???Yes???<br>"+ "will move the existing library to a backup folder<br>"+ " in <i>libraries/old</i> before replacing it.");
            if (result != JOptionPane.YES_OPTION || !oldContrib.backupContribution(editor,true,statusBar)) {
              return null;
            }
          }
 else {
            result=Base.showYesNoQuestion(editor,"Replace","Replace pre-existing \"" + oldContrib.getName() + "\" library?","A pre-existing copy of the \"" + oldContrib.getName() + "\" library<br>"+ "has been found in your sketchbook. Clicking ???Yes???<br>"+ "will permanently delete this library and all of its contents<br>"+ "before replacing it.");
            if (result != JOptionPane.YES_OPTION || !oldContrib.getFolder().delete()) {
              return null;
            }
          }
        }
 else {
          if ((doBackup && !oldContrib.backupContribution(editor,true,statusBar)) || (!doBackup && !oldContrib.getFolder().delete())) {
            return null;
          }
        }
      }
    }
  }
  if (contribFolder.exists()) {
    Base.removeDir(contribFolder);
  }
  if (!getFolder().renameTo(contribFolder)) {
    statusBar.setErrorMessage("Could not move " + getTypeName() + " \""+ getName()+ "\" to the sketchbook.");
    return null;
  }
  return ContributionManager.load(editor.getBase(),contribFolder,getType());
}

{
  FileDialog fd=new FileDialog(editor,"Save sketch folder as...",FileDialog.SAVE);
  if (isReadOnly()) {
    fd.setDirectory(Preferences.get("sketchbook.path"));
  }
 else {
    fd.setDirectory(folder.getParent());
  }
  fd.setFile(folder.getName());
  fd.show();
  String newParentDir=fd.getDirectory();
  String newName=fd.getFile();
  if (newName == null)   return false;
  newName=Sketchbook.sanitizeName(newName);
  File newFolder=new File(newParentDir,newName);
  if (newFolder.equals(folder)) {
    Base.showWarning("You can't fool me","The new sketch name and location are the same as\n" + "the old. I ain't not doin nuthin' not now.",null);
    return false;
  }
  try {
    String newPath=newFolder.getCanonicalPath() + File.separator;
    String oldPath=folder.getCanonicalPath() + File.separator;
    if (newPath.indexOf(oldPath) == 0) {
      Base.showWarning("How very Borges of you","You cannot save the sketch into a folder\n" + "inside itself. This would go on forever.",null);
      return false;
    }
  }
 catch (  IOException e) {
  }
  Base.removeDir(newFolder);
  Base.copyDir(folder,newFolder);
  for (int i=0; i < codeCount; i++) {
    code[i].file=new File(newFolder,code[i].file.getName());
  }
  for (int i=0; i < hiddenCount; i++) {
    hidden[i].file=new File(newFolder,hidden[i].file.getName());
  }
  code[0].file.delete();
  code[0].file=new File(newFolder,newName + ".pde");
  code[0].name=newName;
  code[0].save();
  String oldName=name;
  name=newName;
  File oldFolder=folder;
  folder=newFolder;
  dataFolder=new File(folder,"data");
  codeFolder=new File(folder,"code");
  Base.removeDir(new File(folder,"applet"));
  Base.removeDir(new File(folder,"application"));
  Base.removeDir(new File(folder,"library"));
  save();
  editor.header.repaint();
  return true;
}

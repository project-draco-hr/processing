{
  FileDialog fd=new FileDialog(editor,"Save sketch folder as...",FileDialog.SAVE);
  if (isReadOnly()) {
    fd.setDirectory(Preferences.get("sketchbook.path"));
  }
 else {
    fd.setDirectory(folder.getParent());
  }
  fd.setFile(folder.getName());
  fd.show();
  String newParentDir=fd.getDirectory();
  String newName=fd.getFile();
  if (newName == null)   return false;
  newName=Sketchbook.sanitizeName(newName);
  File codeAlready=new File(folder,newName + ".pde");
  if (codeAlready.exists() && (!newName.equals(name))) {
    Base.showMessage("Nope","You can't save the sketch as \"" + newName + "\"\n"+ "because the sketch already has a tab with that name.");
    return false;
  }
  File hiddenAlready=new File(folder,newName + ".pde.x");
  if (hiddenAlready.exists()) {
    Base.showMessage("Nope","You can't save the sketch as \"" + newName + "\"\n"+ "because the sketch already has a "+ "hidden tab with that name.");
    return false;
  }
  File newFolder=new File(newParentDir,newName);
  if (newFolder.equals(folder)) {
    Base.showWarning("You can't fool me","The new sketch name and location are the same as\n" + "the old. I ain't not doin nuthin' not now.",null);
    return false;
  }
  try {
    String newPath=newFolder.getCanonicalPath() + File.separator;
    String oldPath=folder.getCanonicalPath() + File.separator;
    if (newPath.indexOf(oldPath) == 0) {
      Base.showWarning("How very Borges of you","You cannot save the sketch into a folder\n" + "inside itself. This would go on forever.",null);
      return false;
    }
  }
 catch (  IOException e) {
  }
  if (newFolder.exists()) {
    Base.removeDir(newFolder);
  }
  newFolder.mkdirs();
  if (current.modified) {
    current.program=editor.getText();
  }
  for (int i=1; i < codeCount; i++) {
    File newFile=new File(newFolder,code[i].file.getName());
    code[i].saveAs(newFile);
  }
  for (int i=0; i < hiddenCount; i++) {
    File newFile=new File(newFolder,hidden[i].file.getName());
    hidden[i].saveAs(newFile);
  }
  if (dataFolder.exists()) {
    File newDataFolder=new File(newFolder,"data");
    Base.copyDir(dataFolder,newDataFolder);
  }
  if (codeFolder.exists()) {
    File newCodeFolder=new File(newFolder,"code");
    Base.copyDir(codeFolder,newCodeFolder);
  }
  File newFile=new File(newFolder,newName + ".pde");
  code[0].saveAs(newFile);
  editor.handleOpenUnchecked(newFile.getPath(),currentIndex,editor.textarea.getSelectionStart(),editor.textarea.getSelectionEnd(),editor.textarea.getScrollPosition());
  return true;
}

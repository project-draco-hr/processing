{
  BufferedReader reader=PApplet.createReader(template);
  PrintWriter theOutWriter=PApplet.createWriter(output);
  String line=null;
  while ((line=reader.readLine()) != null) {
    if (line.indexOf("@@") != -1) {
      StringBuffer sb=new StringBuffer(line);
      int start=0, end=0;
      while ((start=sb.indexOf("@@")) != -1) {
        if ((end=sb.indexOf("@@",start + 1)) != -1) {
          String value=fields.get(sb.substring(start + 2,end));
          sb.replace(start,end + 2,value == null ? "" : value);
        }
 else {
          Base.showWarning("Problem writing file from template","The template appears to have an unterminated " + "field. The output may look a little funny.",null);
        }
      }
      line=sb.toString();
    }
    theOutWriter.println(line);
  }
  theOutWriter.close();
}

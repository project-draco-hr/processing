{
  if (!depth)   return 0;
  float ax=m00 * x + m01 * y + m02 * z + m03;
  float ay=m10 * x + m11 * y + m12 * z + m13;
  float az=m20 * x + m21 * y + m22 * z + m23;
  float aw=m30 * x + m31 * y + m32 * z + m33;
  float oz=p20 * ax + p21 * ay + p22 * az + p23 * aw;
  float ow=p30 * ax + p31 * ay + p32 * az + p33 * aw;
  if (ow != 0)   oz/=ow;
  return (oz + 1) / 2.0f;
}

{
  super("Processing",state.checkConfig());
  this.base=base;
  this.state=state;
  this.mode=mode;
  Toolkit.setIcon(this);
  addWindowListener(new WindowAdapter(){
    public void windowClosing(    WindowEvent e){
      base.handleClose(Editor.this,false);
    }
  }
);
  setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);
  addWindowListener(new WindowAdapter(){
    public void windowActivated(    WindowEvent e){
      base.handleActivated(Editor.this);
      fileMenu.insert(base.getRecentMenu(),2);
      Toolkit.setMenuMnemsInside(fileMenu);
      mode.insertImportMenu(sketchMenu);
      Toolkit.setMenuMnemsInside(sketchMenu);
      mode.insertToolbarRecentMenu();
    }
    public void windowDeactivated(    WindowEvent e){
      fileMenu.remove(base.getRecentMenu());
      mode.removeImportMenu(sketchMenu);
      mode.removeToolbarRecentMenu();
    }
  }
);
  timer=new Timer();
  buildMenuBar();
  JPanel contentPain=new JPanel();
  setContentPane(contentPain);
  contentPain.setLayout(new BorderLayout());
  Box box=Box.createVerticalBox();
  Box upper=Box.createVerticalBox();
  initModeMenu();
  toolbar=createToolbar();
  upper.add(toolbar);
  header=new EditorHeader(this);
  upper.add(header);
  textarea=createTextArea();
  textarea.setRightClickPopup(new TextAreaPopup());
  textarea.setHorizontalOffset(JEditTextArea.leftHandGutter);
  consolePanel=new JPanel();
  consolePanel.setLayout(new BorderLayout());
  status=new EditorStatus(this);
  consolePanel.add(status,BorderLayout.NORTH);
  console=new EditorConsole(this);
  console.setBorder(null);
  consolePanel.add(console,BorderLayout.CENTER);
  lineStatus=new EditorLineStatus(this);
  consolePanel.add(lineStatus,BorderLayout.SOUTH);
  upper.add(textarea);
  splitPane=new JSplitPane(JSplitPane.VERTICAL_SPLIT,upper,consolePanel);
  splitPane.setOneTouchExpandable(false);
  splitPane.setContinuousLayout(true);
  splitPane.setResizeWeight(1D);
  splitPane.setBorder(null);
  UIManager.getDefaults().put("SplitPane.border",BorderFactory.createEmptyBorder());
  splitPane.setUI(new BasicSplitPaneUI(){
    public BasicSplitPaneDivider createDefaultDivider(){
      return new BasicSplitPaneDivider(this){
        final Color dividerColor=mode.getColor("divider.color");
        final Color dotColor=mode.getColor("divider.dot.color");
        int dotSize=mode.getInteger("divider.dot.diameter");
        @Override public void paint(        Graphics g){
          Graphics2D g2=(Graphics2D)g;
          g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
          final int w=getSize().width;
          final int h=getSize().height;
          g.setColor(dividerColor);
          g.fillRect(0,0,w,h);
          g.setColor(dotColor);
          int x=w / 2 - dotSize / 2;
          int y=h / 2 - dotSize / 2;
          g.fillOval(x,y,dotSize,dotSize);
        }
      }
;
    }
  }
);
  splitPane.setDividerSize(mode.getInteger("divider.height"));
  box.add(splitPane);
  contentPain.add(box);
  textarea.addCaretListener(new CaretListener(){
    String lastText=textarea.getText();
    public void caretUpdate(    CaretEvent e){
      String newText=textarea.getText();
      if (lastText.equals(newText) && isDirectEdit()) {
        endTextEditHistory();
      }
      lastText=newText;
    }
  }
);
  contentPain.setTransferHandler(new FileDropHandler());
  pack();
  state.apply(this);
  setMinimumSize(new Dimension(Preferences.getInteger("editor.window.width.min"),Preferences.getInteger("editor.window.height.min")));
  applyPreferences();
  addWindowFocusListener(new WindowAdapter(){
    public void windowGainedFocus(    WindowEvent e){
      textarea.requestFocusInWindow();
    }
  }
);
  boolean loaded=handleOpenInternal(path);
  if (!loaded) {
    sketch=null;
  }
  if (Preferences.getBoolean("editor.watcher")) {
    addWindowFocusListener(new ChangeDetector(this));
  }
}

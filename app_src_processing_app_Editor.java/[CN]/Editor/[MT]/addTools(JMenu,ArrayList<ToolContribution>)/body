{
  HashMap<String,JMenuItem> toolItems=new HashMap<String,JMenuItem>();
  for (  final ToolContribution tool : tools) {
    if (safeTool(tool,null)) {
      String title=tool.getMenuTitle();
      final JMenuItem item=new JMenuItem(title);
      item.addActionListener(new ActionListener(){
        public void actionPerformed(        ActionEvent e){
          safeTool(tool,item);
        }
      }
);
      toolItems.put(title,item);
    }
  }
  ArrayList<String> toolList=new ArrayList<String>(toolItems.keySet());
  if (toolList.size() > 0) {
    menu.addSeparator();
    Collections.sort(toolList);
    for (    String title : toolList) {
      menu.add(toolItems.get(title));
    }
  }
}

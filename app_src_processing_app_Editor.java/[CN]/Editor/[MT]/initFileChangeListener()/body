{
  try {
    WatchService watchService=FileSystems.getDefault().newWatchService();
    watcherKey=sketch.getFolder().toPath().register(watchService,StandardWatchEventKinds.ENTRY_CREATE,StandardWatchEventKinds.ENTRY_DELETE,StandardWatchEventKinds.ENTRY_MODIFY);
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  final WatchKey finKey=watcherKey;
  if (finKey != null) {
    addWindowFocusListener(new WindowFocusListener(){
      @Override public void windowGainedFocus(      WindowEvent arg0){
        if (watcherKey != finKey) {
          return;
        }
        if (finKey.isValid()) {
          List<WatchEvent<?>> events=finKey.pollEvents();
          if (!watcherSave) {
            processFileEvents(events);
          }
        }
        List<WatchEvent<?>> events=finKey.pollEvents();
        if (!watcherSave)         processFileEvents(events);
      }
      @Override public void windowLostFocus(      WindowEvent arg0){
        if (watcherKey != finKey) {
          return;
        }
        List<WatchEvent<?>> events=finKey.pollEvents();
        if (!watcherSave) {
          processFileEvents(events);
        }
        watcherSave=false;
      }
    }
);
  }
}

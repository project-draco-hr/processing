{
  SyntaxDocument document=(SyntaxDocument)code.getDocument();
  if (document == null) {
    document=new SyntaxDocument();
    code.setDocument(document);
    document.setTokenMarker(mode.getTokenMarker());
    try {
      document.insertString(0,code.getProgram(),null);
    }
 catch (    BadLocationException bl) {
      bl.printStackTrace();
    }
    document.addUndoableEditListener(new UndoableEditListener(){
      public void undoableEditHappened(      UndoableEditEvent e){
        if (compoundEdit != null) {
          compoundEdit.addEdit(e.getEdit());
        }
 else         if (undo != null) {
          caretUndoStack.push(textarea.getCaretPosition());
          caretRedoStack.clear();
          undo.addEdit(e.getEdit());
          undoAction.updateUndoState();
          redoAction.updateRedoState();
        }
      }
    }
);
  }
  textarea.setDocument(document,code.getSelectionStart(),code.getSelectionStop(),code.getScrollPosition());
  textarea.requestFocus();
  this.undo=code.getUndo();
  undoAction.updateUndoState();
  redoAction.updateRedoState();
}

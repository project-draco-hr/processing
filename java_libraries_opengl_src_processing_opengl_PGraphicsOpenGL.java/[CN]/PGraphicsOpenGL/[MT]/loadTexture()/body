{
  boolean needEndDraw=false;
  if (!drawing) {
    beginDraw();
    needEndDraw=true;
  }
  flush();
  if (primarySurface) {
    loadTextureImpl(Texture.POINT,false);
    if (pgl.primaryIsFboBacked()) {
      pgl.bindPrimaryColorFBO();
      texture.set(pgl.getFboTexTarget(),pgl.getFboTexName(),pgl.getFboWidth(),pgl.getFboHeight(),width,height);
      pgl.bindPrimaryMultiFBO();
    }
 else {
      if (nativePixels == null || nativePixels.length < width * height) {
        nativePixels=new int[width * height];
        nativePixelBuffer=IntBuffer.wrap(nativePixels);
      }
      beginPixelsOp(OP_READ);
      pgl.glReadPixels(0,0,width,height,PGL.GL_RGBA,PGL.GL_UNSIGNED_BYTE,nativePixelBuffer);
      endPixelsOp();
      texture.setNative(nativePixels,0,0,width,height);
    }
  }
 else {
    if (offscreenMultisample) {
      offscreenFramebufferMultisample.copy(offscreenFramebuffer);
    }
    if (offscreenMultisample) {
      pushFramebuffer();
      setFramebuffer(offscreenFramebuffer);
    }
    pgl.glColorMask(false,false,false,true);
    pgl.glClearColor(0,0,0,1);
    pgl.glClear(PGL.GL_COLOR_BUFFER_BIT);
    pgl.glColorMask(true,true,true,true);
    if (offscreenMultisample) {
      popFramebuffer();
    }
  }
  if (needEndDraw) {
    endDraw();
  }
}

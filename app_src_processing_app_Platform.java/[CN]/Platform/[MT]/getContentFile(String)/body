{
  if (processingRoot == null) {
    String path=Base.class.getProtectionDomain().getCodeSource().getLocation().getPath();
    String decodedPath=PApplet.urlDecode(path);
    if (decodedPath.contains("/app/bin")) {
      final File build=new File(decodedPath,"../../build").getAbsoluteFile();
      if (Platform.isMacOS()) {
        processingRoot=new File(build,"macosx/work/Processing.app/Contents/Java");
      }
 else       if (Platform.isWindows()) {
        processingRoot=new File(build,"windows/work");
      }
 else       if (Platform.isLinux()) {
        processingRoot=new File(build,"linux/work");
      }
    }
 else {
      File jarFolder=new File(decodedPath).getParentFile();
      if (jarFolder.getName().equals("lib")) {
        processingRoot=jarFolder.getParentFile();
      }
 else       if (Platform.isMacOS()) {
        processingRoot=jarFolder;
      }
      if (processingRoot == null || !processingRoot.exists()) {
        System.err.println("Could not find lib folder via " + jarFolder.getAbsolutePath() + ", switching to user.dir");
        final String userDir=System.getProperty("user.dir");
        processingRoot=new File(PApplet.urlDecode(userDir));
      }
    }
  }
  return new File(processingRoot,name);
}

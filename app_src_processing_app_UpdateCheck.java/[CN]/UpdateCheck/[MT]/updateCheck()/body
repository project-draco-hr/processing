{
  Random r=new Random();
  long id=r.nextLong();
  String idString=Preferences.get("update.id");
  if (idString != null) {
    id=Long.parseLong(idString);
  }
 else {
    Preferences.set("update.id",String.valueOf(id));
  }
  String info;
  info=URLEncoder.encode(id + "\t" + PApplet.nf(Base.REVISION,4)+ "\t"+ System.getProperty("java.version")+ "\t"+ System.getProperty("java.vendor")+ "\t"+ System.getProperty("os.name")+ "\t"+ System.getProperty("os.version")+ "\t"+ System.getProperty("os.arch"),"UTF-8");
  int latest=readInt(downloadURL + "?" + info);
  String lastString=Preferences.get("update.last");
  long now=System.currentTimeMillis();
  if (lastString != null) {
    long when=Long.parseLong(lastString);
    if (now - when < ONE_DAY) {
      return;
    }
  }
  Preferences.set("update.last",String.valueOf(now));
  String prompt="A new version of Processing is available,\n" + "would you like to visit the Processing download page?";
  String contributionPrompt="There are updates available for some of the installed contributions,\n" + "would you like to open the the Contribution Manager now?";
  if (base.activeEditor != null) {
    if (latest > Base.REVISION) {
      Object[] options={"Yes","No"};
      int result=JOptionPane.showOptionDialog(base.activeEditor,prompt,"Update",JOptionPane.YES_NO_OPTION,JOptionPane.QUESTION_MESSAGE,null,options,options[0]);
      if (result == JOptionPane.YES_OPTION) {
        Base.openURL("http://processing.org/download/");
      }
    }
 else {
      if (base.libraryManagerFrame == null)       base.libraryManagerFrame=new ContributionManager(base.getActiveEditor());
      Thread.sleep(5 * 1000);
      if (!base.libraryManagerFrame.hasBeenShow() && base.libraryManagerFrame.contributionListing.hasUpdates()) {
        Object[] options={"Yes","No"};
        int result=JOptionPane.showOptionDialog(base.activeEditor,contributionPrompt,"Update",JOptionPane.YES_NO_OPTION,JOptionPane.QUESTION_MESSAGE,null,options,options[0]);
        if (result == JOptionPane.YES_OPTION) {
          base.handleShowUpdates();
        }
      }
    }
  }
}

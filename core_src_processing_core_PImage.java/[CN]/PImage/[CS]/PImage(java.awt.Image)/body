{
  if (img instanceof BufferedImage) {
    BufferedImage bi=(BufferedImage)img;
    width=bi.getWidth();
    height=bi.getHeight();
    pixels=new int[width * height];
    WritableRaster raster=bi.getRaster();
    raster.getDataElements(0,0,width,height,pixels);
  }
 else {
    width=img.getWidth(null);
    height=img.getHeight(null);
    pixels=new int[width * height];
    PixelGrabber pg=new PixelGrabber(img,0,0,width,height,pixels,0,width);
    try {
      pg.grabPixels();
    }
 catch (    InterruptedException e) {
    }
  }
  format=RGB;
  cache=null;
}

{
  SerialMenuListener listener=new SerialMenuListener();
  String defaultName=get("serial.port","unspecified");
  boolean problem=false;
  try {
    Enumeration portList=CommPortIdentifier.getPortIdentifiers();
    while (portList.hasMoreElements()) {
      CommPortIdentifier portId=(CommPortIdentifier)portList.nextElement();
      if (portId.getPortType() == CommPortIdentifier.PORT_SERIAL) {
        String name=portId.getName();
        CheckboxMenuItem mi=new CheckboxMenuItem(name,name.equals(defaultName));
        mi.addItemListener(listener);
        serialMenu.add(mi);
      }
    }
  }
 catch (  UnsatisfiedLinkError e) {
    e.printStackTrace();
    problem=true;
  }
catch (  Exception e) {
    System.out.println("exception building serial menu");
    e.printStackTrace();
  }
  if (serialMenu.getItemCount() == 0) {
    serialMenu.setEnabled(false);
  }
  if (problem && firstTime) {
    JOptionPane.showMessageDialog(this,"Serial port support not installed.\n" + "Check the readme for instructions\n" + "if you need to use the serial port.    ","Serial Port Warning",JOptionPane.WARNING_MESSAGE);
  }
}

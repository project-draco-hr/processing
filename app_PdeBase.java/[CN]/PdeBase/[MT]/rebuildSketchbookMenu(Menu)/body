{
  menu.removeAll();
  try {
    sketchbookFolder=new File("sketchbook");
    sketchbookPath=sketchbookFolder.getCanonicalPath();
    if (!sketchbookFolder.exists()) {
      System.err.println("sketchbook folder doesn't exist, " + "making a new one");
      sketchbookFolder.mkdirs();
    }
    String userPath=sketchbookPath + File.separator + editor.userName;
    File userFolder=new File(userPath);
    if (!userFolder.exists()) {
      System.err.println("sketchbook folder for '" + editor.userName + "' doesn't exist, creating a new one");
      userFolder.mkdirs();
    }
    SketchbookMenuListener userMenuListener=new SketchbookMenuListener(userPath);
    String entries[]=new File(userPath).list();
    boolean added=false;
    for (int j=0; j < entries.length; j++) {
      if (entries[j].equals(".") || entries[j].equals("..") || entries[j].equals("CVS")|| entries[j].equals(".cvsignore"))       continue;
      added=true;
      if (new File(userPath,entries[j] + File.separator + entries[j]+ ".pde").exists()) {
        MenuItem item=new MenuItem(entries[j]);
        item.addActionListener(userMenuListener);
        menu.add(item);
      }
    }
    if (!added) {
      MenuItem item=new MenuItem("No sketches");
      item.setEnabled(false);
      menu.add(item);
    }
    menu.addSeparator();
    String toplevel[]=sketchbookFolder.list();
    added=false;
    for (int i=0; i < toplevel.length; i++) {
      if (toplevel[i].equals(editor.userName) || toplevel[i].equals(".") || toplevel[i].equals("..")|| toplevel[i].equals("CVS")|| toplevel[i].equals(".cvsignore"))       continue;
      added=true;
      Menu subMenu=new Menu(toplevel[i]);
      File subFolder=new File(sketchbookFolder,toplevel[i]);
      String subPath=subFolder.getCanonicalPath();
      SketchbookMenuListener subMenuListener=new SketchbookMenuListener(subPath);
      entries=subFolder.list();
      if (entries != null) {
        for (int j=0; j < entries.length; j++) {
          if (entries[j].equals(".") || entries[j].equals("..") || entries[j].equals("CVS")|| entries[j].equals(".cvsignore"))           continue;
          if (new File(subFolder,entries[j] + File.separator + entries[j]+ ".pde").exists()) {
            MenuItem item=new MenuItem(entries[j]);
            item.addActionListener(subMenuListener);
            subMenu.add(item);
          }
        }
      }
      menu.add(subMenu);
    }
    if (added)     menu.addSeparator();
    MenuItem item=new MenuItem("Refresh");
    item.addActionListener(this);
    menu.add(item);
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
}

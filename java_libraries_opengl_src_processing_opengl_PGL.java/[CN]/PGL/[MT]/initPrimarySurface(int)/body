{
  profile=GLProfile.getMaxFixedFunc();
  if (profile == null) {
    pg.parent.die("Cannot get a valid OpenGL profile");
  }
  capabilities=new GLCapabilities(profile);
  if (1 < antialias) {
    capabilities.setSampleBuffers(true);
    capabilities.setNumSamples(antialias);
  }
 else {
    capabilities.setSampleBuffers(false);
  }
  AWTGraphicsScreen screen=(AWTGraphicsScreen)AWTGraphicsScreen.createDefault();
  AWTGraphicsConfiguration config=(AWTGraphicsConfiguration)GraphicsConfigurationFactory.getFactory(AWTGraphicsDevice.class).chooseGraphicsConfiguration(capabilities,capabilities,null,screen);
  NativeWindow win=NativeWindowFactory.getNativeWindow(pg.parent.frame,config);
  window=GLWindow.create(win,capabilities);
  canvas=new NewtCanvasAWT(window);
  pg.parent.frame.add(canvas);
  pg.parent.frame.validate();
  window.addGLEventListener(new PGLEventListener());
  animator=new CustomAnimator(window);
  animator.setThreadName("Processing-OpenGL");
  animator.start();
  initialized=true;
}

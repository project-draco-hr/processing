{
  final StringWriter stdout=new StringWriter();
  final StringWriter stderr=new StringWriter();
  final long startTime=System.currentTimeMillis();
  final Process process=Runtime.getRuntime().exec(cmd);
  final CountDownLatch latch=new CountDownLatch(2);
  if (teeOut) {
    new StringRedirectThread(process.getInputStream(),latch,stdout,new OutputStreamWriter(System.out)).start();
  }
 else {
    new StringRedirectThread(process.getInputStream(),latch,stdout).start();
  }
  if (teeErr) {
    new StringRedirectThread(process.getErrorStream(),latch,stderr,new OutputStreamWriter(System.err)).start();
  }
 else {
    new StringRedirectThread(process.getErrorStream(),latch,stderr).start();
  }
  latch.await();
  return new ProcessResult(PApplet.join(cmd,' '),process.waitFor(),stdout.toString(),stderr.toString(),System.currentTimeMillis() - startTime);
}

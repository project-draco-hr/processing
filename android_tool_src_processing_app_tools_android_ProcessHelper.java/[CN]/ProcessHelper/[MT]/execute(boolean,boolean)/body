{
  final StringWriter outWriter=new StringWriter();
  final StringWriter errWriter=new StringWriter();
  final long startTime=System.currentTimeMillis();
  final Process process=Runtime.getRuntime().exec(cmd);
  final StreamPump outpump=new StreamPump(process.getInputStream()).addTarget(outWriter);
  if (teeOut) {
    outpump.addTarget(System.out);
  }
  outpump.start();
  final StreamPump errpump=new StreamPump(process.getErrorStream()).addTarget(errWriter);
  if (teeErr) {
    errpump.addTarget(System.err);
  }
  errpump.start();
  return new ProcessResult(getCommand(),process.waitFor(),outWriter.toString(),errWriter.toString(),System.currentTimeMillis() - startTime);
}

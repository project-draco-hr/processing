{
  super.allocate();
  if (!matricesAllocated) {
    projection=new PMatrix3D();
    camera=new PMatrix3D();
    cameraInv=new PMatrix3D();
    modelview=new PMatrix3D();
    matricesAllocated=true;
  }
  if (!lightsAllocated) {
    lightType=new int[PGL.MAX_LIGHTS];
    lightPosition=new float[PGL.MAX_LIGHTS][4];
    lightNormal=new float[PGL.MAX_LIGHTS][4];
    lightAmbient=new float[PGL.MAX_LIGHTS][4];
    lightDiffuse=new float[PGL.MAX_LIGHTS][4];
    lightSpecular=new float[PGL.MAX_LIGHTS][4];
    lightFalloffConstant=new float[PGL.MAX_LIGHTS];
    lightFalloffLinear=new float[PGL.MAX_LIGHTS];
    lightFalloffQuadratic=new float[PGL.MAX_LIGHTS];
    lightSpotAngle=new float[PGL.MAX_LIGHTS];
    lightSpotConcentration=new float[PGL.MAX_LIGHTS];
    currentLightSpecular=new float[4];
    lightsAllocated=true;
  }
  if (primarySurface) {
    if (pgl.initialized) {
      reapplySettings();
    }
  }
 else {
    if (pgl.initialized) {
      updateOffscreenContext();
      reapplySettings();
    }
  }
}

{
  if (drawing) {
    showWarning("P3D: Already called beginDraw().");
    return;
  }
  if (primarySurface) {
    if (!pgl.initialized) {
      initPrimary();
    }
    if (!pgl.initOnscreenDraw()) {
      return;
    }
    pgl.detainContext();
  }
 else {
    if (!pgl.initialized) {
      initOffscreen();
    }
    pushFramebuffer();
    if (offscreenMultisample) {
      setFramebuffer(offscreenFramebufferMultisample);
      pgl.setDrawBuffer(0);
    }
 else {
      setFramebuffer(offscreenFramebuffer);
    }
  }
  updatePGL();
  if (!glParamsRead) {
    getGLParameters();
  }
  if (!settingsInited) {
    defaultSettings();
  }
  report("top beginDraw()");
  if (!primarySurface) {
    pg.saveGLState();
  }
  inGeo.reset();
  tessGeo.reset();
  texCache.reset();
  super.noTexture();
  setDefaultBlend();
  if (hints[DISABLE_DEPTH_TEST]) {
    pgl.disableDepthTest();
  }
 else {
    pgl.enableDepthTest();
  }
  pgl.setDepthFunc(PGL.LESS_OR_EQUAL);
  if (hints[DISABLE_DEPTH_MASK]) {
    pgl.disableDepthMask();
  }
 else {
    pgl.enableDepthMask();
  }
  if (hints[ENABLE_ACCURATE_2D]) {
    flushMode=FLUSH_CONTINUOUSLY;
  }
 else {
    flushMode=FLUSH_WHEN_FULL;
  }
  pgl.getViweport(savedViewport);
  viewport[0]=0;
  viewport[1]=0;
  viewport[2]=width;
  viewport[3]=height;
  pgl.setViewport(viewport);
  if (resized) {
    background(0);
    if (texture != null) {
      this.removeCache(pg);
      this.removeParams(pg);
      texture=null;
      loadTexture();
    }
    resized=false;
  }
  if (sizeChanged) {
    camera();
    perspective();
    sizeChanged=false;
  }
 else {
    modelview.set(camera);
  }
  noLights();
  lightFalloff(1,0,0);
  lightSpecular(0,0,0);
  pgl.setFrontFace(PGL.CLOCKWISE);
  setSurfaceParams();
  normalX=normalY=normalZ=0;
  pgl.setClearColor(0,0,0,0);
  pgl.clearDepthAndStencilBuffers();
  if (primarySurface) {
    pgl.beginOnscreenDraw();
  }
 else {
    pgl.beginOffscreenDraw();
  }
  drawing=true;
  report("bot beginDraw()");
}

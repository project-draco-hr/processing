{
  gl.glViewport(0,0,width,height);
  gl.glMatrixMode(GL10.GL_PROJECTION);
  gl.glPopMatrix();
  gl.glMatrixMode(GL10.GL_MODELVIEW);
  gl.glPopMatrix();
  if (hints[DISABLE_DEPTH_TEST]) {
    gl.glDisable(GL10.GL_DEPTH_TEST);
    gl.glClear(GL10.GL_DEPTH_BUFFER_BIT);
  }
 else {
    gl.glEnable(GL10.GL_DEPTH_TEST);
  }
  if (hints[DISABLE_DEPTH_MASK]) {
    gl.glDepthMask(false);
  }
 else {
    gl.glDepthMask(true);
  }
  if (blend) {
    blend(blendMode);
  }
 else {
    noBlend();
  }
  if (fill) {
    calcR=fillR;
    calcG=fillG;
    calcB=fillB;
    calcA=fillA;
    fillFromCalc();
  }
  calcR=ambientR;
  calcG=ambientG;
  calcB=ambientB;
  ambientFromCalc();
  calcR=specularR;
  calcG=specularG;
  calcB=specularB;
  specularFromCalc();
  shininess(shininess);
  calcR=emissiveR;
  calcG=emissiveG;
  calcB=emissiveB;
  emissiveFromCalc();
  if (lights) {
    lights();
    for (int i=0; i < lightCount; i++) {
      glLightEnable(i);
      if (lightType[i] == AMBIENT) {
        glLightEnable(i);
        glLightAmbient(i);
        glLightPosition(i);
        glLightFalloff(i);
        glLightNoSpot(i);
        glLightNoDiffuse(i);
        glLightNoSpecular(i);
      }
 else       if (lightType[i] == DIRECTIONAL) {
        glLightEnable(i);
        glLightNoAmbient(i);
        glLightDirection(i);
        glLightDiffuse(i);
        glLightSpecular(i);
        glLightFalloff(i);
        glLightNoSpot(i);
      }
 else       if (lightType[i] == POINT) {
        glLightEnable(i);
        glLightNoAmbient(i);
        glLightPosition(i);
        glLightDiffuse(i);
        glLightSpecular(i);
        glLightFalloff(i);
        glLightNoSpot(i);
      }
 else       if (lightType[i] == SPOT) {
        glLightEnable(i);
        glLightNoAmbient(i);
        glLightPosition(i);
        glLightDirection(i);
        glLightDiffuse(i);
        glLightSpecular(i);
        glLightFalloff(i);
        glLightSpotAngle(i);
        glLightSpotConcentration(i);
      }
    }
  }
 else {
    noLights();
  }
  gl.glShadeModel(GL10.GL_SMOOTH);
  gl.glFrontFace(GL10.GL_CW);
  gl.glDepthFunc(GL10.GL_LEQUAL);
  gl.glEnable(GL10.GL_COLOR_MATERIAL);
  gl.glEnable(GL10.GL_NORMALIZE);
  gl.glEnable(GL10.GL_RESCALE_NORMAL);
  gl.glLightModelfv(GL10.GL_LIGHT_MODEL_AMBIENT,baseLight,0);
  gl.glLightModelx(GL10.GL_LIGHT_MODEL_TWO_SIDE,0);
}

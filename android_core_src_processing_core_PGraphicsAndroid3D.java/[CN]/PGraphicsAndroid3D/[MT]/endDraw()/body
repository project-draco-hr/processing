{
  report("top endDraw()");
  if (USE_GBUFFER && GBUFFER_MERGE_ALL && (gbuffer != null)) {
    gl.glEnableClientState(GL11.GL_VERTEX_ARRAY);
    gl.glEnableClientState(GL11.GL_COLOR_ARRAY);
    gl.glEnableClientState(GL11.GL_NORMAL_ARRAY);
    gbuffer.render();
    gl.glDisableClientState(GL11.GL_NORMAL_ARRAY);
    gl.glDisableClientState(GL11.GL_COLOR_ARRAY);
    gl.glDisableClientState(GL11.GL_VERTEX_ARRAY);
  }
  if (primarySurface) {
    if (!clearColorBuffer0) {
      if (fboSupported) {
        if (offscreenFramebuffer != null) {
          popFramebuffer();
          gl.glClearColor(0,0,0,0);
          gl.glClear(GL10.GL_COLOR_BUFFER_BIT | GL10.GL_DEPTH_BUFFER_BIT);
          drawOffscreenTexture(offscreenIndex);
          swapOffscreenIndex();
        }
      }
 else {
        if (texture != null) {
          copyFrameToTexture();
        }
      }
    }
    gl.glFlush();
  }
 else {
    if (offscreenFramebuffer != null) {
      popFramebuffer();
      swapOffscreenIndex();
    }
    a3d.restoreGLState();
  }
  report("bot endDraw()");
}

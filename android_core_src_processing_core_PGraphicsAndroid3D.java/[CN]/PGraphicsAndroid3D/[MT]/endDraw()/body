{
  report("top endDraw()");
  gl.glViewport(viewport[0],viewport[1],viewport[2],viewport[3]);
  if (USE_GEO_BUFFER) {
    if (GEO_BUFFER_ACCUM_ALL && geoBuffer != null && 0 < geoBuffer.vertCount) {
      geoBuffer.pre();
      geoBuffer.render();
      geoBuffer.post();
    }
  }
  if (primarySurface) {
    if (!clearColorBuffer0) {
      if (fboSupported) {
        if (offscreenFramebuffer != null) {
          popFramebuffer();
          gl.glClearColor(0,0,0,0);
          gl.glClear(GL10.GL_COLOR_BUFFER_BIT | GL10.GL_DEPTH_BUFFER_BIT);
          drawOffscreenTexture(offscreenIndex);
          swapOffscreenIndex();
        }
      }
 else {
        if (texture != null) {
          copyFrameToTexture();
        }
      }
    }
    gl.glFlush();
  }
 else {
    if (offscreenFramebuffer != null) {
      popFramebuffer();
      swapOffscreenIndex();
    }
    a3d.restoreGLState();
  }
  report("bot endDraw()");
}

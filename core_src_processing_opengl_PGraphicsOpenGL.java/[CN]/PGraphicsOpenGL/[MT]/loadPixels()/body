{
  if (primarySurface && sized) {
    return;
  }
  boolean needEndDraw=false;
  if (!drawing) {
    beginDraw();
    needEndDraw=true;
  }
  if (!arePixelsUpToDate) {
    flush();
  }
  allocatePixels();
  if (!arePixelsUpToDate) {
    readPixels();
  }
  arePixelsUpToDate=true;
  if (needEndDraw) {
    endDraw();
  }
}

{
  if (primarySurface) {
    pushFramebuffer();
    if (op == OP_READ) {
      setFramebuffer(readFramebuffer);
      pgl.readBuffer(pgl.primaryReadBuffer());
      if (pgl.isFBOBacked()) {
        pgl.forceUpdate();
      }
    }
 else {
      setFramebuffer(drawFramebuffer);
      pgl.drawBuffer(pgl.primaryDrawBuffer());
    }
    offscreenNotCurrent=true;
  }
 else {
    if (op == OP_READ) {
      offscreenNotCurrent=offscreenFramebuffer != currentFramebuffer;
      if (offscreenNotCurrent) {
        pushFramebuffer();
        setFramebuffer(offscreenFramebuffer);
        pgl.updateOffscreen(pgPrimary.pgl);
      }
      pgl.readBuffer(PGL.COLOR_ATTACHMENT0);
    }
 else {
      if (offscreenMultisample) {
        offscreenNotCurrent=offscreenFramebufferMultisample != currentFramebuffer;
      }
 else {
        offscreenNotCurrent=offscreenFramebuffer != currentFramebuffer;
      }
      if (offscreenNotCurrent) {
        pushFramebuffer();
        if (offscreenMultisample) {
          setFramebuffer(offscreenFramebufferMultisample);
        }
 else {
          setFramebuffer(offscreenFramebuffer);
        }
        pgl.updateOffscreen(pgPrimary.pgl);
      }
      pgl.drawBuffer(PGL.COLOR_ATTACHMENT0);
    }
  }
  pixelsOp=op;
}

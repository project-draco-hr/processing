{
  if (primarySurface) {
    if (pgl.primaryIsFboBacked()) {
      if (op == OP_READ) {
        offscreenNotCurrent=true;
        pgl.bindPrimaryColorFBO();
        pgl.readBuffer(pgl.primaryDrawBuffer());
      }
 else {
        offscreenNotCurrent=false;
        pgl.drawBuffer(pgl.primaryDrawBuffer());
      }
    }
 else {
      if (op == OP_READ) {
        pgl.readBuffer(pgl.primaryDrawBuffer());
      }
 else {
        pgl.drawBuffer(pgl.primaryDrawBuffer());
      }
      offscreenNotCurrent=false;
    }
  }
 else {
    if (op == OP_READ) {
      offscreenNotCurrent=offscreenFramebuffer != currentFramebuffer;
      if (offscreenNotCurrent) {
        pushFramebuffer();
        setFramebuffer(offscreenFramebuffer);
        pgl.updateOffscreen(pgPrimary.pgl);
      }
      pgl.readBuffer(PGL.COLOR_ATTACHMENT0);
    }
 else {
      if (offscreenMultisample) {
        offscreenNotCurrent=offscreenFramebufferMultisample != currentFramebuffer;
      }
 else {
        offscreenNotCurrent=offscreenFramebuffer != currentFramebuffer;
      }
      if (offscreenNotCurrent) {
        pushFramebuffer();
        if (offscreenMultisample) {
          setFramebuffer(offscreenFramebufferMultisample);
        }
 else {
          setFramebuffer(offscreenFramebuffer);
        }
        pgl.updateOffscreen(pgPrimary.pgl);
      }
      pgl.drawBuffer(PGL.COLOR_ATTACHMENT0);
    }
  }
  pixelsOp=op;
}

{
  if (profile == null) {
    profile=GLProfile.getDefault();
  }
 else {
    if (canvasAWT != null) {
      canvasAWT.removeGLEventListener(listener);
      pg.parent.removeListeners(canvasAWT);
      pg.parent.remove(canvasAWT);
    }
 else     if (canvasNEWT != null) {
      animator.stop();
      animator.remove(window);
      window.removeGLEventListener(listener);
      pg.parent.removeListeners(canvasNEWT);
      pg.parent.remove(canvasNEWT);
    }
    setFramerate=false;
  }
  GLCapabilities caps=new GLCapabilities(profile);
  if (1 < antialias && !needScreenFBO) {
    caps.setSampleBuffers(true);
    caps.setNumSamples(antialias);
  }
 else {
    caps.setSampleBuffers(false);
  }
  if (PApplet.platform == PConstants.MACOSX) {
    caps.setFBO(enable_screen_FBO_macosx);
  }
 else   if (PApplet.platform == PConstants.WINDOWS) {
    caps.setFBO(enable_screen_FBO_windows);
  }
 else   if (PApplet.platform == PConstants.LINUX) {
    caps.setFBO(enable_screen_FBO_linux);
  }
 else {
    caps.setFBO(enable_screen_FBO_other);
  }
  caps.setDepthBits(24);
  caps.setStencilBits(8);
  caps.setAlphaBits(8);
  caps.setBackgroundOpaque(true);
  caps.setOnscreen(true);
  if (toolkit == AWT) {
    canvasAWT=new GLCanvas(caps);
    canvasAWT.setBounds(0,0,pg.width,pg.height);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasAWT,BorderLayout.CENTER);
    pg.parent.removeListeners(pg.parent);
    pg.parent.addListeners(canvasAWT);
    listener=new PGLListener();
    canvasAWT.addGLEventListener(listener);
    capabilities=canvasAWT.getChosenGLCapabilities();
    canvas=canvasAWT;
    canvasNEWT=null;
  }
 else   if (toolkit == NEWT) {
    window=GLWindow.create(caps);
    canvasNEWT=new NewtCanvasAWT(window);
    Dimension size0=new Dimension(pg.width,pg.height);
    canvasNEWT.setShallUseOffscreenLayer(true);
    canvasNEWT.setPreferredSize(size0);
    canvasNEWT.setMinimumSize(size0);
    canvasNEWT.setSize(size0);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasNEWT,BorderLayout.CENTER);
    pg.parent.removeListeners(pg.parent);
    pg.parent.addListeners(canvasNEWT);
    listener=new PGLListener();
    window.addGLEventListener(listener);
    animator=new PGLAnimator(window);
    animator.start();
    capabilities=window.getChosenGLCapabilities();
    canvas=canvasNEWT;
    canvasAWT=null;
  }
  initialized=true;
}

{
  if (ENABLE_OSX_SCREEN_FBO) {
    needScreenFBO=false;
    glColorFbo[0]=0;
    String osName=System.getProperty("os.name");
    if (osName.equals("Mac OS X")) {
      String version=System.getProperty("os.version");
      String[] parts=version.split("\\.");
      if (2 <= parts.length) {
        int num=Integer.parseInt(parts[1]);
        if (MIN_OSX_VER_FOR_SCREEN_FBO <= num && MIN_SAMPLES_FOR_SCREEN_FBO <= qualityToSamples(pg.quality)) {
          needScreenFBO=true;
        }
      }
    }
  }
  if (profile == null) {
    profile=GLProfile.getDefault();
  }
 else {
    if (canvasAWT != null) {
      canvasAWT.removeGLEventListener(listener);
      pg.parent.removeListeners(canvasAWT);
      pg.parent.remove(canvasAWT);
    }
 else     if (canvasNEWT != null) {
      animator.stop();
      animator.remove(window);
      window.removeGLEventListener(listener);
      pg.parent.removeListeners(canvasNEWT);
      pg.parent.remove(canvasNEWT);
    }
    setFramerate=false;
  }
  GLCapabilities caps=new GLCapabilities(profile);
  if (1 < antialias && !needScreenFBO) {
    caps.setSampleBuffers(true);
    caps.setNumSamples(antialias);
  }
 else {
    caps.setSampleBuffers(false);
  }
  caps.setDepthBits(24);
  caps.setStencilBits(8);
  caps.setAlphaBits(8);
  caps.setBackgroundOpaque(true);
  if (toolkit == AWT) {
    canvasAWT=new GLCanvas(caps);
    canvasAWT.setBounds(0,0,pg.width,pg.height);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasAWT,BorderLayout.CENTER);
    pg.parent.removeListeners(pg.parent);
    pg.parent.addListeners(canvasAWT);
    listener=new PGLListener();
    canvasAWT.addGLEventListener(listener);
    capabilities=canvasAWT.getChosenGLCapabilities();
    canvas=canvasAWT;
    canvasNEWT=null;
  }
 else   if (toolkit == NEWT) {
    window=GLWindow.create(caps);
    canvasNEWT=new NewtCanvasAWT(window);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasNEWT,BorderLayout.CENTER);
    pg.parent.removeListeners(pg.parent);
    pg.parent.addListeners(canvasNEWT);
    listener=new PGLListener();
    window.addGLEventListener(listener);
    animator=new PGLAnimator(window);
    animator.start();
    capabilities=window.getChosenGLCapabilities();
    canvas=canvasNEWT;
    canvasAWT=null;
  }
  initialized=true;
}

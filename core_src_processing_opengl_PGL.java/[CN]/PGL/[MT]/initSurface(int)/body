{
  if (profile == null) {
    profile=GLProfile.getDefault();
  }
 else {
    if (canvasAWT != null) {
      canvasAWT.removeGLEventListener(listener);
      pg.parent.removeListeners(canvasAWT);
      pg.parent.remove(canvasAWT);
    }
 else     if (canvasNEWT != null) {
      window.removeGLEventListener(listener);
      pg.parent.remove(canvasNEWT);
    }
    sinkFBO=backFBO=frontFBO=null;
    setFramerate=false;
  }
  GLCapabilities caps=new GLCapabilities(profile);
  caps.setBackgroundOpaque(true);
  caps.setOnscreen(true);
  if (USE_JOGL_FBOLAYER) {
    if (1 < antialias) {
      caps.setSampleBuffers(true);
      caps.setNumSamples(antialias);
    }
 else {
      caps.setSampleBuffers(false);
    }
  }
 else {
    caps.setSampleBuffers(false);
    reqNumSamples=qualityToSamples(antialias);
  }
  caps.setDepthBits(request_depth_bits);
  caps.setStencilBits(request_stencil_bits);
  caps.setAlphaBits(request_alpha_bits);
  caps.setDefaultColor(javaToNativeARGB(pg.backgroundColor));
  if (toolkit == AWT) {
    canvasAWT=new GLCanvas(caps);
    canvasAWT.setBounds(0,0,pg.width,pg.height);
    canvasAWT.setBackground(new Color(pg.backgroundColor,true));
    canvasAWT.setFocusable(true);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasAWT,BorderLayout.CENTER);
    pg.parent.validate();
    pg.parent.removeListeners(pg.parent);
    pg.parent.addListeners(canvasAWT);
    canvas=canvasAWT;
    canvasNEWT=null;
    listener=new PGLListener();
    canvasAWT.addGLEventListener(listener);
  }
 else   if (toolkit == NEWT) {
    window=GLWindow.create(caps);
    canvasNEWT=new NewtCanvasAWT(window);
    canvasNEWT.setBounds(0,0,pg.width,pg.height);
    canvasNEWT.setBackground(new Color(pg.backgroundColor,true));
    canvasNEWT.setFocusable(true);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasNEWT,BorderLayout.CENTER);
    pg.parent.validate();
    if (events == NEWT) {
      NEWTMouseListener mouseListener=new NEWTMouseListener();
      window.addMouseListener(mouseListener);
      NEWTKeyListener keyListener=new NEWTKeyListener();
      window.addKeyListener(keyListener);
      NEWTWindowListener winListener=new NEWTWindowListener();
      window.addWindowListener(winListener);
      canvasNEWT.addFocusListener(pg.parent);
    }
 else     if (events == AWT) {
      pg.parent.removeListeners(canvasNEWT);
      pg.parent.addListeners(canvasNEWT);
    }
    canvas=canvasNEWT;
    canvasAWT=null;
    listener=new PGLListener();
    window.addGLEventListener(listener);
  }
  fboLayerCreated=false;
  fboLayerInUse=false;
  firstFrame=true;
}

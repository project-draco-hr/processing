{
  if (profile == null) {
    profile=GLProfile.getDefault();
  }
 else {
    if (canvasAWT != null) {
      if (useAnimator) {
        animator.stop();
        animator.remove(canvasAWT);
      }
      canvasAWT.removeGLEventListener(listener);
      pg.parent.removeListeners(canvasAWT);
      pg.parent.remove(canvasAWT);
    }
 else     if (canvasNEWT != null) {
      if (useAnimator) {
        animator.stop();
        animator.remove(window);
      }
      window.removeGLEventListener(listener);
      pg.parent.remove(canvasNEWT);
    }
    sinkFBO=backFBO=frontFBO=null;
    setFramerate=false;
  }
  GLCapabilities caps=new GLCapabilities(profile);
  caps.setBackgroundOpaque(true);
  caps.setOnscreen(true);
  if (USE_JOGL_FBOLAYER) {
    if (1 < antialias) {
      caps.setSampleBuffers(true);
      caps.setNumSamples(antialias);
    }
 else {
      caps.setSampleBuffers(false);
    }
  }
 else {
    caps.setSampleBuffers(false);
    reqNumSamples=qualityToSamples(antialias);
  }
  caps.setDepthBits(request_depth_bits);
  caps.setStencilBits(request_stencil_bits);
  caps.setAlphaBits(request_alpha_bits);
  if (toolkit == AWT) {
    canvasAWT=new GLCanvas(caps);
    canvasAWT.setBounds(0,0,pg.width,pg.height);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasAWT,BorderLayout.CENTER);
    pg.parent.removeListeners(pg.parent);
    pg.parent.addListeners(canvasAWT);
    capabilities=canvasAWT.getChosenGLCapabilities();
    canvas=canvasAWT;
    canvasNEWT=null;
    listener=new PGLListener();
    canvasAWT.addGLEventListener(listener);
    if (useAnimator) {
      animator=new PGLAnimator(canvasAWT);
      animator.start();
    }
  }
 else   if (toolkit == NEWT) {
    window=GLWindow.create(caps);
    canvasNEWT=new NewtCanvasAWT(window);
    canvasNEWT.setBounds(0,0,pg.width,pg.height);
    pg.parent.setLayout(new BorderLayout());
    pg.parent.add(canvasNEWT,BorderLayout.CENTER);
    com.jogamp.newt.event.MouseListener mouseListener=new NEWTMouseAdapter();
    window.addMouseListener(mouseListener);
    com.jogamp.newt.event.KeyListener keyListener=new NEWTKeyAdapter();
    window.addKeyListener(keyListener);
    com.jogamp.newt.event.WindowListener winListener=new NEWTWindowListener();
    window.addWindowListener(winListener);
    capabilities=window.getChosenGLCapabilities();
    canvas=canvasNEWT;
    canvasAWT=null;
    listener=new PGLListener();
    window.addGLEventListener(listener);
    if (useAnimator) {
      animator=new PGLAnimator(window);
      animator.start();
    }
  }
  fboLayerCreated=false;
  fboLayerInUse=false;
  firstFrame=true;
  needToClearBuffers=true;
}

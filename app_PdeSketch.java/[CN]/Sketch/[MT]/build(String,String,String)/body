{
  externalRuntime=false;
  externalPaths=null;
  String externalImports[]=null;
  externalCode=new File(sketchDir,"code");
  if (externalCode.exists()) {
    externalRuntime=true;
    externalPaths=PdeCompiler.contentsToClassPath(externalCode);
    externalImports=PdeCompiler.magicImports(externalPaths);
  }
 else {
    externalCode=null;
  }
  PdePreprocessor preprocessor=new PdePreprocessor();
  try {
    className=preprocessor.write(program,buildPath,className,imports,false);
  }
 catch (  antlr.RecognitionException re) {
    throw new PdeException(re.getMessage(),re.getLine() - 1,re.getColumn());
  }
catch (  antlr.TokenStreamRecognitionException tsre) {
    PatternMatcher matcher=new Perl5Matcher();
    PatternCompiler compiler=new Perl5Compiler();
    String mess="^line (\\d+):(\\d+):\\s";
    Pattern pattern=compiler.compile(mess);
    PatternMatcherInput input=new PatternMatcherInput(tsre.toString());
    if (matcher.contains(input,pattern)) {
      MatchResult result=matcher.getMatch();
      int line=Integer.parseInt(result.group(1).toString());
      int column=Integer.parseInt(result.group(2).toString());
      throw new PdeException(tsre.getMessage(),line - 1,column);
    }
 else {
      throw new PdeException(tsre.toString());
    }
  }
catch (  PdeException pe) {
    throw pe;
  }
catch (  Exception ex) {
    System.err.println("Uncaught exception type:" + ex.getClass());
    ex.printStackTrace();
    throw new PdeException(ex.toString());
  }
  if (PdePreprocessor.programType == PdePreprocessor.ADVANCED) {
    externalRuntime=true;
  }
  PdeCompiler compiler=new PdeCompiler(buildPath,className,externalCode,this);
  messageStream=new PdeMessageStream(compiler);
  boolean success=compiler.compile(new PrintStream(messageStream));
  return success ? className : null;
}

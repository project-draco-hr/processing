{
  try {
    while ((Thread.currentThread() == thread) && !finished) {
      g.requestDisplay(this);
      try {
        int nap=(looping || finished) ? 1 : 10000;
        if (frameCount == 1) {
          nap=1;
        }
 else         if (finished) {
          nap=0;
        }
 else         if (looping) {
          if (frameRateTarget != 0) {
            if (frameRateLastDelayTime == 0) {
              frameRateLastDelayTime=System.currentTimeMillis();
            }
 else {
              long timeToLeave=frameRateLastDelayTime + (long)(1000.0f / frameRateTarget);
              long now=System.currentTimeMillis();
              nap=(int)(timeToLeave - now);
              if (nap > 0) {
                frameRateLastDelayTime=timeToLeave;
              }
 else {
                frameRateLastDelayTime=now;
              }
            }
          }
 else {
            nap=1;
          }
        }
        if (CRUSTY_THREADS) {
          Thread.sleep(nap);
        }
 else {
synchronized (blocker) {
            if (nap > 0)             blocker.wait(nap);
          }
        }
      }
 catch (      InterruptedException e) {
      }
    }
  }
 catch (  Exception e) {
    finished=true;
    if (e instanceof InvocationTargetException) {
      e=(Exception)(((InvocationTargetException)e).getTargetException());
    }
    exception=e;
    if (leechErr != null) {
      leechErr.println(LEECH_WAKEUP);
      e.printStackTrace(leechErr);
      e.printStackTrace(System.out);
    }
 else {
      System.err.println(LEECH_WAKEUP);
      e.printStackTrace();
      e.printStackTrace(System.out);
    }
  }
  if (THREAD_DEBUG)   println(Thread.currentThread().getName() + " thread finished");
  stop();
  if (exit) {
    if ((leechErr == null) && !online) {
      System.exit(0);
    }
  }
}

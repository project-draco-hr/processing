{
  if (extension == null) {
    String lower=filename.toLowerCase();
    int dot=filename.lastIndexOf('.');
    if (dot == -1) {
      extension="unknown";
    }
    extension=lower.substring(dot + 1);
    int question=extension.indexOf('?');
    if (question != -1) {
      extension=extension.substring(0,question);
    }
  }
  extension=extension.toLowerCase();
  if (extension.equals("tga")) {
    try {
      PImage image=loadImageTGA(filename);
      return image;
    }
 catch (    IOException e) {
      e.printStackTrace();
      return null;
    }
  }
  if (extension.equals("tif") || extension.equals("tiff")) {
    byte bytes[]=loadBytes(filename);
    PImage image=(bytes == null) ? null : PImage.loadTIFF(bytes);
    return image;
  }
  try {
    if (extension.equals("jpg") || extension.equals("jpeg") || extension.equals("gif")|| extension.equals("png")|| extension.equals("unknown")) {
      byte bytes[]=loadBytes(filename);
      if (bytes == null) {
        return null;
      }
 else {
        Image awtImage=Toolkit.getDefaultToolkit().createImage(bytes);
        PImage image=loadImageMT(awtImage);
        if (image.width == -1) {
          System.err.println("The file " + filename + " contains bad image data, or may not be an image.");
        }
        if (extension.equals("gif") || extension.equals("png")) {
          image.checkAlpha();
        }
        return image;
      }
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  if (loadImageFormats == null) {
    loadImageFormats=ImageIO.getReaderFormatNames();
  }
  if (loadImageFormats != null) {
    for (int i=0; i < loadImageFormats.length; i++) {
      if (extension.equals(loadImageFormats[i])) {
        PImage image;
        image=loadImageIO(filename);
        return image;
      }
    }
  }
  System.err.println("Could not find a method to load " + filename);
  return null;
}

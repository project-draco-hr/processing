{
  if (parent != null) {
    firstVertex=((PShape3D)parent).lastVertex;
    firstIndex=((PShape3D)parent).lastIndex;
    firstStrokeVertex=((PShape3D)parent).lastStrokeVertex;
    firstStrokeIndex=((PShape3D)parent).lastStrokeIndex;
    if (incFirst) {
      firstVertex++;
      firstIndex++;
      if (useStroke) {
        firstStrokeVertex++;
        firstStrokeIndex++;
      }
    }
  }
 else {
    firstVertex=0;
    firstIndex=0;
    firstStrokeVertex=0;
    firstStrokeIndex=0;
  }
  lastVertex=firstVertex;
  lastIndex=firstIndex;
  lastStrokeVertex=firstStrokeVertex;
  lastStrokeIndex=firstStrokeIndex;
  if (family == GROUP) {
    vertexCount=0;
    indexCount=0;
    for (int i=0; i < childCount; i++) {
      PShape3D child=(PShape3D)children[i];
      child.aggregateImpl(0 < i);
    }
    if (0 < childCount) {
      PShape3D child=(PShape3D)children[0];
      firstVertex=child.firstVertex;
      firstIndex=child.firstIndex;
      firstStrokeVertex=child.firstStrokeVertex;
      firstStrokeIndex=child.firstStrokeIndex;
    }
 else {
      firstVertex=lastVertex=-1;
      firstIndex=lastIndex=-1;
      firstStrokeVertex=lastStrokeVertex=-1;
      firstStrokeIndex=lastStrokeIndex=-1;
    }
    useStroke=0 < strokeVertexCount && 0 < strokeIndexCount;
  }
 else {
    if (0 < vertexCount) {
      lastVertex=firstVertex + vertexCount - 1;
    }
    if (0 < indexCount) {
      for (int i=0; i < indexCount; i++) {
        indices[i]+=firstVertex;
      }
      lastIndex=firstIndex + indexCount - 1;
    }
    if (0 < strokeVertexCount) {
      lastStrokeVertex=firstStrokeVertex + strokeVertexCount - 1;
    }
    if (0 < strokeIndexCount) {
      for (int i=0; i < strokeIndexCount; i++) {
        strokeIndices[i]+=firstStrokeVertex;
      }
      lastStrokeIndex=firstStrokeIndex + strokeIndexCount - 1;
    }
  }
  if (parent != null) {
    ((PShape3D)parent).lastVertex=lastVertex;
    ((PShape3D)parent).vertexCount+=vertexCount;
    ((PShape3D)parent).lastIndex=lastIndex;
    ((PShape3D)parent).indexCount+=indexCount;
    ((PShape3D)parent).lastStrokeVertex=lastStrokeVertex;
    ((PShape3D)parent).strokeVertexCount+=strokeVertexCount;
    ((PShape3D)parent).lastStrokeIndex=lastStrokeIndex;
    ((PShape3D)parent).strokeIndexCount+=strokeIndexCount;
  }
}

{
  try {
    PixelFormat format=new PixelFormat(PGL.REQUESTED_ALPHA_BITS,PGL.REQUESTED_DEPTH_BITS,PGL.REQUESTED_STENCIL_BITS,pgl.reqNumSamples);
    Display.create(format);
  }
 catch (  LWJGLException e) {
    e.printStackTrace();
    System.exit(0);
  }
  keyPoller=new KeyPoller(sketch);
  keyPoller.start();
  mousePoller=new MousePoller(sketch);
  mousePoller.start();
  setSize(sketchWidth,sketchHeight);
  sketch.start();
  int x0=Display.getX();
  int y0=Display.getY();
  while ((Thread.currentThread() == thread) && !sketch.finished) {
    if (Display.wasResized()) {
      setSize(Display.getWidth(),Display.getHeight());
    }
    pgl.setThread(thread);
    checkPause();
    sketch.handleDraw();
    Display.update();
    if (sketch.frameCount == 1) {
      requestFocus();
    }
    Display.sync((int)frameRateTarget);
    int x=Display.getX();
    int y=Display.getY();
    if (externalMessages && (x != x0 || y0 != y)) {
      System.err.println(PApplet.EXTERNAL_MOVE + " " + x+ " "+ y);
      System.err.flush();
    }
    x0=x;
    y0=y;
    if (Display.isCloseRequested()) {
      sketch.exit();
      break;
    }
  }
  keyPoller.requestStop();
  mousePoller.requestStop();
  sketch.dispose();
  Display.destroy();
  frame.dispose();
  if (sketch.exitCalled()) {
    sketch.exitActual();
  }
}

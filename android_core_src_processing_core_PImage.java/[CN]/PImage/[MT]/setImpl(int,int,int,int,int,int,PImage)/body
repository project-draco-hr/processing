{
  if (src.pixels == null) {
    src.loadPixels();
  }
  if (pixels == null) {
    if (!bitmap.isMutable()) {
      bitmap=bitmap.copy(Config.ARGB_8888,true);
    }
    int offset=sy * src.width + sx;
    bitmap.setPixels(src.pixels,offset,src.width,dx,dy,sw,sh);
  }
 else {
    int srcOffset=sy * src.width + sx;
    int dstOffset=dy * width + dx;
    for (int y=sy; y < sy + sh; y++) {
      System.arraycopy(src.pixels,srcOffset,pixels,dstOffset,sw);
      srcOffset+=src.width;
      dstOffset+=width;
    }
    updatePixelsImpl(dx,dy,sw,sh);
  }
}

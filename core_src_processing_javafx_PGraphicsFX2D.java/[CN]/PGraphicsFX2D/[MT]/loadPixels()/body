{
  flush();
  if ((pixels == null) || (pixels.length != pixelWidth * pixelHeight)) {
    pixels=new int[pixelWidth * pixelHeight];
  }
  checkSnapshotImage();
  SnapshotParameters sp=new SnapshotParameters();
  if (pixelDensity == 2) {
    sp.setTransform(Transform.scale(2,2));
  }
  snapshotImage=((PSurfaceFX)surface).canvas.snapshot(sp,snapshotImage);
  PixelReader pr=snapshotImage.getPixelReader();
  pr.getPixels(0,0,pixelWidth,pixelHeight,argbFormat,pixels,0,pixelWidth);
}

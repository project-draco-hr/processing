{
  if (evt.getKeyCode() == KeyEvent.VK_ESCAPE) {
    if (suggestion != null) {
      if (suggestion.isVisible()) {
        log("esc key");
        hideSuggestion();
        evt.consume();
        return;
      }
    }
  }
  if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
    if (suggestion != null) {
      if (suggestion.isVisible()) {
        if (suggestion.insertSelection()) {
          hideSuggestion();
          evt.consume();
          return;
        }
      }
    }
  }
  if (evt.getID() == KeyEvent.KEY_PRESSED) {
switch (evt.getKeyCode()) {
case KeyEvent.VK_DOWN:
      if (suggestion != null)       if (suggestion.isVisible()) {
        suggestion.moveDown();
        return;
      }
    break;
case KeyEvent.VK_UP:
  if (suggestion != null)   if (suggestion.isVisible()) {
    suggestion.moveUp();
    return;
  }
break;
case KeyEvent.VK_BACK_SPACE:
log("BK Key");
break;
case KeyEvent.VK_SPACE:
if (suggestion != null) if (suggestion.isVisible()) {
log("Space bar, hide completion list");
suggestion.hide();
}
break;
default :
break;
}
}
super.processKeyEvent(evt);
if (evt.getID() == KeyEvent.KEY_TYPED) {
char keyChar=evt.getKeyChar();
if (keyChar == KeyEvent.VK_ENTER || keyChar == KeyEvent.VK_ESCAPE) {
return;
}
 else if (keyChar == KeyEvent.VK_SPACE || keyChar == KeyEvent.VK_TAB || keyChar == KeyEvent.CHAR_UNDEFINED) {
return;
}
if (evt.isAltDown() || evt.isControlDown() || evt.isMetaDown()) {
return;
}
final KeyEvent evt2=evt;
SwingWorker worker=new SwingWorker(){
protected Object doInBackground() throws Exception {
errorCheckerService.runManualErrorCheck();
if (ExperimentalMode.codeCompletionsEnabled) log(" Typing: " + fetchPhrase(evt2) + " "+ (evt2.getKeyChar() == KeyEvent.VK_ENTER));
return null;
}
}
;
worker.execute();
}
}

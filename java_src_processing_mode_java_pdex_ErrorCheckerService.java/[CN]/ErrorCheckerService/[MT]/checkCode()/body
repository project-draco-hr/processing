{
  CodeCheckResult result=new CodeCheckResult();
  result.sourceCode=preprocessCode();
  char[] sourceCodeArray=result.sourceCode.toCharArray();
  List<IProblem> problems;
{
{
      result.syntaxErrors=true;
      result.containsErrors=true;
      parser.setSource(sourceCodeArray);
      parser.setKind(ASTParser.K_COMPILATION_UNIT);
      parser.setCompilerOptions(COMPILER_OPTIONS);
      parser.setStatementsRecovery(true);
      result.compilationUnit=(CompilationUnit)parser.createAST(null);
      problems=Arrays.asList(result.compilationUnit.getProblems());
      if (problems.isEmpty()) {
        result.syntaxErrors=false;
        result.containsErrors=false;
      }
 else {
        result.syntaxErrors=true;
        result.containsErrors=true;
      }
    }
  }
  if (problems.isEmpty() && !editor.hasJavaTabs()) {
    String sourceCode=xqpreproc.handle(result.sourceCode,programImports);
    prepareCompilerClasspath();
{
{
        parser.setSource(sourceCodeArray);
        parser.setKind(ASTParser.K_COMPILATION_UNIT);
        parser.setCompilerOptions(COMPILER_OPTIONS);
        parser.setStatementsRecovery(true);
        result.compilationUnit=(CompilationUnit)parser.createAST(null);
        result.sourceCode=sourceCode;
        try {
          if (loadCompClass) {
            classPath=new URL[classpathJars.size()];
            classPath=classpathJars.toArray(classPath);
            classLoader=new URLClassLoader(classPath,null);
            loadCompClass=false;
          }
          problems=compileAndReturnProblems(className,sourceCode,COMPILER_OPTIONS,classLoader);
        }
 catch (        Exception e) {
          System.err.println("compileCheck() problem." + e);
          e.printStackTrace();
          cancel();
        }
catch (        NoClassDefFoundError e) {
          e.printStackTrace();
          cancel();
        }
      }
    }
  }
  if (problems != null) {
    for (    IProblem problem : problems) {
      if (problem.getMessage().contains("Syntax error, insert \":: IdentifierOrNew\"")) {
        continue;
      }
      int sourceLine=problem.getSourceLineNumber();
      int[] a=calculateTabIndexAndLineNumber(sourceLine);
      Problem p=new Problem(problem,a[0],a[1]);
      if (p.isError()) {
        result.containsErrors=true;
      }
 else       if (p.isWarning() && !JavaMode.warningsEnabled) {
        continue;
      }
      result.problems.add(p);
    }
  }
synchronized (astGenerator) {
    astGenerator.buildAST(result.sourceCode,result.compilationUnit);
  }
  return result;
}

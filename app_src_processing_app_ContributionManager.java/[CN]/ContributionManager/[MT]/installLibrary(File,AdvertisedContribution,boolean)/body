{
  File tempDir=unzipFileToTemp(libFile);
  try {
    ArrayList<Library> discoveredLibs=Library.list(tempDir);
    if (discoveredLibs.isEmpty()) {
      discoveredLibs=Library.list(tempDir.getParentFile());
    }
    if (discoveredLibs != null && discoveredLibs.size() == 1) {
      Library discoveredLib=discoveredLibs.get(0);
      File propFile=new File(discoveredLib.getFolder(),"library.properties");
      if (ad == null || writePropertiesFile(propFile,ad)) {
        return installLibrary(discoveredLib,confirmReplace);
      }
 else {
        statusBar.setErrorMessage(ERROR_OVERWRITING_PROPERTIES_MESSAGE);
      }
    }
 else {
      if (discoveredLibs == null) {
        statusBar.setErrorMessage(ContributionManager.DISCOVERY_INTERNAL_ERROR_MESSAGE);
      }
 else       if (discoveredLibs.isEmpty()) {
        statusBar.setErrorMessage(ContributionManager.DISCOVERY_NONE_FOUND_ERROR_MESSAGE);
      }
 else {
        statusBar.setErrorMessage("There were multiple libraries in the file, so we're ignoring it.");
      }
    }
  }
 catch (  IOException ioe) {
    statusBar.setErrorMessage(ContributionManager.DISCOVERY_INTERNAL_ERROR_MESSAGE);
  }
  return null;
}

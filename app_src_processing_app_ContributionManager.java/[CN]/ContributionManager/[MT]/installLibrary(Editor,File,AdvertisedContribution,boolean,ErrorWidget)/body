{
  File tempDir=unzipFileToTemp(libFile,statusBar);
  try {
    ArrayList<File> libfolders=Library.discover(tempDir);
    if (libfolders.isEmpty()) {
      libfolders=Library.discover(tempDir.getParentFile());
    }
    if (libfolders != null && libfolders.size() == 1) {
      File libfolder=libfolders.get(0);
      File propFile=new File(libfolder,"library.properties");
      if (ad == null || writePropertiesFile(propFile,ad)) {
        Library newlib=new Library(libfolder,null);
        return installLibrary(editor,newlib,confirmReplace,statusBar);
      }
 else {
        statusBar.setErrorMessage(ERROR_OVERWRITING_PROPERTIES_MESSAGE);
      }
    }
 else {
      if (libfolders == null) {
        statusBar.setErrorMessage(ContributionManager.DISCOVERY_INTERNAL_ERROR_MESSAGE);
      }
 else       if (libfolders.isEmpty()) {
        statusBar.setErrorMessage(ContributionManager.DISCOVERY_NONE_FOUND_ERROR_MESSAGE);
      }
 else {
        statusBar.setErrorMessage("There were multiple libraries in the file, so we're ignoring it.");
      }
    }
  }
 catch (  IOException ioe) {
    statusBar.setErrorMessage(ContributionManager.DISCOVERY_INTERNAL_ERROR_MESSAGE);
  }
  return null;
}

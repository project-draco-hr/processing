{
  String portString=Preferences.get("android.emulator.port");
  if (portString == null) {
    portString="5566";
    Preferences.set("android.emulator.port",portString);
  }
  final String[] cmd=new String[]{"emulator","-avd",AVD.ECLAIR.name,"-port",portString,"-no-boot-anim"};
  System.err.println("Launching emulator");
  final Process p=Runtime.getRuntime().exec(cmd);
  new StreamPump(p.getInputStream()).addTarget(System.out).start();
  new StreamPump(p.getErrorStream()).addTarget(System.err).start();
  new Thread(new Runnable(){
    public void run(){
      try {
        System.err.println("Starting to wait for emulator process.");
        final int result=p.waitFor();
        System.err.println("Emulator process exited with " + result);
      }
 catch (      final InterruptedException e) {
        System.err.println("Emulator interrupted.");
      }
    }
  }
);
}

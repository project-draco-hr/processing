{
  report("top endDraw()");
  if (!drawing) {
    PGraphics.showWarning(NO_BEGIN_DRAW_ERROR);
    return;
  }
  flush();
  if (PGL.SAVE_SURFACE_TO_PIXELS && (!pgPrimary.pgl.initialized || parent.frameCount == 0)) {
    saveSurfaceToPixels();
    restoreSurface=true;
  }
  if (primarySurface) {
    pgl.endDraw(clearColorBuffer0);
    pgl.flush();
  }
 else {
    endOffscreenDraw();
  }
  if (pgCurrent == pgPrimary) {
    pgCurrent=null;
  }
 else {
    pgCurrent=pgPrimary;
  }
  drawing=false;
  pgCurrent=null;
  report("bot endDraw()");
}

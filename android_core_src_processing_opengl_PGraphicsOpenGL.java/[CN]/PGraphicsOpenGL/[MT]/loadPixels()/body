{
  boolean needEndDraw=false;
  if (!drawing) {
    beginDraw();
    needEndDraw=true;
  }
  if (!setgetPixels) {
    flush();
  }
  allocatePixels();
  if (!setgetPixels) {
    readPixels();
    if (primarySurface) {
      loadTextureImpl(POINT);
      pixelsToTexture();
    }
  }
  if (needEndDraw) {
    endDraw();
  }
}

{
  boolean needEndDraw=false;
  if (!drawing) {
    beginDraw();
    needEndDraw=true;
  }
  flush();
  if (primarySurface) {
    if (pgl.isFBOBacked()) {
      pgl.syncBackTexture();
      PApplet.println("FBO backed");
    }
 else {
      loadTextureImpl(Texture.POINT,false);
      if (nativePixels == null || nativePixels.length < width * height) {
        nativePixels=new int[width * height];
        if (PGL.USE_DIRECT_PIXEL_BUFFERS) {
          nativePixelBuffer=PGL.allocateDirectIntBuffer(width * height);
        }
 else {
          nativePixelBuffer=IntBuffer.wrap(nativePixels);
        }
      }
      beginPixelsOp(OP_READ);
      try {
        pgl.readPixels(0,0,width,height,PGL.RGBA,PGL.UNSIGNED_BYTE,nativePixelBuffer);
      }
 catch (      IndexOutOfBoundsException e) {
      }
      endPixelsOp();
      texture.setNative(nativePixelBuffer,0,0,width,height);
      PApplet.println("not FBO backed");
    }
  }
 else {
    if (offscreenMultisample) {
      multisampleFramebuffer.copy(offscreenFramebuffer,currentFramebuffer);
    }
  }
  if (needEndDraw) {
    endDraw();
  }
}

{
  if (menu != null) {
    menu.removeAll();
  }
 else {
    menu=new JMenu();
    popup=menu.getPopupMenu();
    add(popup);
    popup.setLightWeightPopupEnabled(true);
  }
  JMenuItem item;
  item=new JMenuItem("New Tab");
  item.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      editor.sketch.newCode();
    }
  }
);
  menu.add(item);
  item=new JMenuItem("Rename");
  item.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      editor.sketch.renameCode();
      if (editor.sketch.current == editor.sketch.code[0]) {
        editor.sketchbook.rebuildMenus();
      }
    }
  }
);
  menu.add(item);
  item=new JMenuItem("Delete");
  item.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      editor.sketch.deleteCode();
    }
  }
);
  menu.add(item);
  item=new JMenuItem("Hide");
  item.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      editor.sketch.hideCode();
    }
  }
);
  menu.add(item);
  hideItem=item;
  JMenu unhide=new JMenu("Unhide");
  ActionListener unhideListener=new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      String which=(String)e.getActionCommand();
      editor.sketch.unhideCode(which);
      rebuildMenu();
    }
  }
;
  Sketch sketch=editor.sketch;
  if (sketch != null) {
    for (int i=0; i < sketch.hiddenCount; i++) {
      item=new JMenuItem(sketch.hidden[i].name);
      item.setActionCommand(sketch.hidden[i].name);
      item.addActionListener(unhideListener);
      unhide.add(item);
    }
  }
  if (unhide.getItemCount() == 0) {
    unhide.setEnabled(false);
  }
  menu.add(unhide);
  menu.addSeparator();
  item=Editor.newJMenuItem("Previous Tab",'[',true);
  menu.add(item);
  item=Editor.newJMenuItem("Next Tab",']',true);
  menu.add(item);
  if (sketch != null) {
    menu.addSeparator();
    ActionListener jumpListener=new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        editor.sketch.setCurrent(e.getActionCommand());
      }
    }
;
    for (int i=0; i < sketch.codeCount; i++) {
      item=new JMenuItem(sketch.code[i].name);
      item.addActionListener(jumpListener);
      menu.add(item);
    }
  }
}

{
  PGraphicsOpenGL pg=primaryPG.get();
  if (currentPG == null) {
    setRenderer(pg.getCurrentPG());
    loadAttributes();
    loadUniforms();
  }
  setCommonUniforms();
  PGraphicsOpenGL g=currentPG.get();
  if (g == null)   return;
  if (-1 < vertexLoc)   pgl.enableVertexAttribArray(vertexLoc);
  if (-1 < colorLoc)   pgl.enableVertexAttribArray(colorLoc);
  if (-1 < texCoordLoc)   pgl.enableVertexAttribArray(texCoordLoc);
  if (-1 < normalLoc)   pgl.enableVertexAttribArray(normalLoc);
  if (-1 < normalMatLoc) {
    g.updateGLNormal();
    setUniformMatrix(normalMatLoc,g.glNormal);
  }
  if (-1 < ambientLoc)   pgl.enableVertexAttribArray(ambientLoc);
  if (-1 < specularLoc)   pgl.enableVertexAttribArray(specularLoc);
  if (-1 < emissiveLoc)   pgl.enableVertexAttribArray(emissiveLoc);
  if (-1 < shininessLoc)   pgl.enableVertexAttribArray(shininessLoc);
  int count=g.lightCount;
  setUniformValue(lightCountLoc,count);
  if (0 < count) {
    setUniformVector(lightPositionLoc,g.lightPosition,4,count);
    setUniformVector(lightNormalLoc,g.lightNormal,3,count);
    setUniformVector(lightAmbientLoc,g.lightAmbient,3,count);
    setUniformVector(lightDiffuseLoc,g.lightDiffuse,3,count);
    setUniformVector(lightSpecularLoc,g.lightSpecular,3,count);
    setUniformVector(lightFalloffLoc,g.lightFalloffCoefficients,3,count);
    setUniformVector(lightSpotLoc,g.lightSpotParameters,2,count);
  }
  if (-1 < directionLoc)   pgl.enableVertexAttribArray(directionLoc);
  if (-1 < offsetLoc)   pgl.enableVertexAttribArray(offsetLoc);
  if (-1 < perspectiveLoc) {
    if (g.getHint(ENABLE_STROKE_PERSPECTIVE) && g.nonOrthoProjection()) {
      setUniformValue(perspectiveLoc,1);
    }
 else {
      setUniformValue(perspectiveLoc,0);
    }
  }
  if (-1 < scaleLoc) {
    if (g.getHint(DISABLE_OPTIMIZED_STROKE)) {
      setUniformValue(scaleLoc,1.0f,1.0f,1.0f);
    }
 else {
      float f=PGL.STROKE_DISPLACEMENT;
      if (g.orthoProjection()) {
        setUniformValue(scaleLoc,1,1,f);
      }
 else {
        setUniformValue(scaleLoc,f,f,f);
      }
    }
  }
}

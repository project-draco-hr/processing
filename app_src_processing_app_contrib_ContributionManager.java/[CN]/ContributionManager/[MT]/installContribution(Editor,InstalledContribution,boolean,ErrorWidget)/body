{
  ArrayList<InstalledContribution> oldContribs=getContributions(newContrib.getType(),editor);
  String libFolderName=newContrib.getFolder().getName();
  File libraryDestination=ContributionManager.getSketchbookContribFolder(editor.getBase(),newContrib.getType());
  File newContribDest=new File(libraryDestination,libFolderName);
  for (  InstalledContribution oldContrib : oldContribs) {
    if ((oldContrib.getFolder().exists() && oldContrib.getFolder().equals(newContribDest)) || (oldContrib.getId() != null && oldContrib.getId().equals(newContrib.getId()))) {
      if (ContributionManager.requiresRestart(oldContrib)) {
        if (!backupContribution(editor,oldContrib,false,statusBar)) {
          return null;
        }
      }
 else {
        int result=0;
        boolean doBackup=Preferences.getBoolean("contribution.backup.on_install");
        if (confirmReplace) {
          if (doBackup) {
            result=Base.showYesNoQuestion(editor,"Replace","Replace pre-existing \"" + oldContrib.getName() + "\" library?","A pre-existing copy of the \"" + oldContrib.getName() + "\" library<br>"+ "has been found in your sketchbook. Clicking ???Yes???<br>"+ "will move the existing library to a backup folder<br>"+ " in <i>libraries/old</i> before replacing it.");
            if (result != JOptionPane.YES_OPTION || !backupContribution(editor,oldContrib,true,statusBar)) {
              return null;
            }
          }
 else {
            result=Base.showYesNoQuestion(editor,"Replace","Replace pre-existing \"" + oldContrib.getName() + "\" library?","A pre-existing copy of the \"" + oldContrib.getName() + "\" library<br>"+ "has been found in your sketchbook. Clicking ???Yes???<br>"+ "will permanently delete this library and all of its contents<br>"+ "before replacing it.");
            if (result != JOptionPane.YES_OPTION || !oldContrib.getFolder().delete()) {
              return null;
            }
          }
        }
 else {
          if ((doBackup && !backupContribution(editor,oldContrib,true,statusBar)) || (!doBackup && !oldContrib.getFolder().delete())) {
            return null;
          }
        }
      }
    }
  }
  if (newContribDest.exists()) {
    Base.removeDir(newContribDest);
  }
  if (newContrib.getFolder().renameTo(newContribDest)) {
    Base base=editor.getBase();
    ContributionManager.create(base,newContribDest,newContrib.getType());
  }
 else {
    String errorMsg=null;
switch (newContrib.getType()) {
case LIBRARY:
      errorMsg="Could not move library \"" + newContrib.getName() + "\" to sketchbook.";
    break;
case LIBRARY_COMPILATION:
  break;
case TOOL:
errorMsg="Could not move tool \"" + newContrib.getName() + "\" to sketchbook.";
break;
case MODE:
break;
}
statusBar.setErrorMessage(errorMsg);
}
return null;
}

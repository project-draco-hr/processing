{
  try {
    if (!hasFocus())     return;
    boolean trigger=(evt.getModifiers() & InputEvent.BUTTON3_MASK) != 0;
    if (!trigger && evt.isPopupTrigger())     trigger=true;
    if (trigger && (popup != null)) {
      popup.show(painter,evt.getX(),evt.getY());
      return;
    }
    int line=yToLine(evt.getY());
    int offset=xToOffset(line,evt.getX());
    int dot=getLineStartOffset(line) + offset;
switch (evt.getClickCount()) {
case 1:
      doSingleClick(evt,line,offset,dot);
    break;
case 2:
  try {
    doDoubleClick(evt,line,offset,dot);
  }
 catch (  BadLocationException bl) {
    bl.printStackTrace();
  }
break;
case 3:
doTripleClick(evt,line,offset,dot);
break;
}
}
 catch (ArrayIndexOutOfBoundsException aioobe) {
aioobe.printStackTrace();
int line=yToLine(evt.getY());
System.out.println("line is " + line + ", line count is "+ getLineCount());
}
}

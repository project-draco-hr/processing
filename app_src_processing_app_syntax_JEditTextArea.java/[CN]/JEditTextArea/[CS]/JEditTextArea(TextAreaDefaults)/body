{
  enableEvents(AWTEvent.KEY_EVENT_MASK);
  caretTimer=new Timer(500,new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      if (hasFocus()) {
        blinkCaret();
      }
    }
  }
);
  caretTimer.setInitialDelay(500);
  caretTimer.start();
  painter=new TextAreaPainter(this,defaults);
  documentHandler=new DocumentHandler();
  eventListenerList=new EventListenerList();
  caretEvent=new MutableCaretEvent();
  lineSegment=new Segment();
  bracketLine=bracketPosition=-1;
  blink=true;
  setLayout(new ScrollLayout());
  add(CENTER,painter);
  add(RIGHT,vertical=new JScrollBar(Adjustable.VERTICAL));
  add(BOTTOM,horizontal=new JScrollBar(Adjustable.HORIZONTAL));
  vertical.addAdjustmentListener(new AdjustHandler());
  horizontal.addAdjustmentListener(new AdjustHandler());
  painter.addComponentListener(new ComponentHandler());
  painter.addMouseListener(new MouseHandler());
  painter.addMouseMotionListener(new DragHandler());
  addFocusListener(new FocusHandler());
  setFocusTraversalKeysEnabled(false);
  setInputHandler(defaults.inputHandler);
  setDocument(defaults.document);
  editable=defaults.editable;
  caretVisible=defaults.caretVisible;
  caretBlinks=defaults.caretBlinks;
  electricScroll=defaults.electricScroll;
  addMouseWheelListener(new MouseWheelListener(){
    public void mouseWheelMoved(    MouseWheelEvent e){
      if (scrollBarsInitialized) {
        if (e.getScrollType() == MouseWheelEvent.WHEEL_UNIT_SCROLL) {
          int amt=e.getUnitsToScroll();
          boolean skip=Base.isMacOS() && e.isShiftDown();
          if (!skip) {
            vertical.setValue(vertical.getValue() + amt);
          }
        }
      }
    }
  }
);
}

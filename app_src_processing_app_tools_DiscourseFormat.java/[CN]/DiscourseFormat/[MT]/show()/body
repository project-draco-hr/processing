{
  StringBuffer cf=new StringBuffer("[quote]");
  int selStart=parent.getSelectionStart();
  int selStop=parent.getSelectionEnd();
  int startLine=parent.getSelectionStartLine();
  int stopLine=parent.getSelectionEndLine();
  if (selStart == selStop) {
    startLine=0;
    stopLine=parent.getLineCount() - 1;
  }
 else {
    if (parent.getLineStartOffset(stopLine) == selStop) {
      stopLine--;
    }
  }
  for (int i=startLine; i <= stopLine; i++) {
    appendFormattedLine(cf,i);
  }
  cf.append("[/quote]");
  StringSelection formatted=new StringSelection(cf.toString());
  Clipboard clipboard=Toolkit.getDefaultToolkit().getSystemClipboard();
  clipboard.setContents(formatted,new ClipboardOwner(){
    public void lostOwnership(    Clipboard clipboard,    Transferable contents){
    }
  }
);
  editor.message("Code formatted for processing.org/discourse " + "has been copied to the clipboard.");
}

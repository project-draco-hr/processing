{
  StringBuffer cf=new StringBuffer("[quote]\n");
  int selStart=textarea.getSelectionStart();
  int selStop=textarea.getSelectionStop();
  int startLine=textarea.getSelectionStartLine();
  int stopLine=textarea.getSelectionStopLine();
  if (selStart == selStop) {
    startLine=0;
    stopLine=textarea.getLineCount() - 1;
  }
 else {
    if (textarea.getLineStartOffset(stopLine) == selStop) {
      stopLine--;
    }
  }
  for (int i=startLine; i <= stopLine; i++) {
    appendFormattedLine(cf,i);
  }
  cf.append("\n[/quote]");
  StringSelection formatted=new StringSelection(cf.toString());
  Clipboard clipboard=Toolkit.getDefaultToolkit().getSystemClipboard();
  clipboard.setContents(formatted,new ClipboardOwner(){
    public void lostOwnership(    Clipboard clipboard,    Transferable contents){
    }
  }
);
  editor.statusNotice("Code formatted for processing.org/discourse " + "has been copied to the clipboard.");
}

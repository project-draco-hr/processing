{
  this.sketch=sketch;
  Display display=NewtFactory.createDisplay(null);
  display.addReference();
  Screen screen=NewtFactory.createScreen(display,0);
  screen.addReference();
  int screenWidth=screen.getWidth();
  int screenHeight=screen.getHeight();
  if (deviceIndex >= 0) {
  }
  System.out.println("deviceIndex: " + deviceIndex);
  System.out.println("Screen res " + screenWidth + "x"+ screenHeight);
  ArrayList<MonitorDevice> monitors=new ArrayList<MonitorDevice>();
  for (int i=0; i < screen.getMonitorDevices().size(); i++) {
    MonitorDevice monitor=screen.getMonitorDevices().get(i);
    System.out.println("Monitor " + monitor.getId() + " ************");
    System.out.println(monitor.toString());
    System.out.println(monitor.getViewportInWindowUnits());
    System.out.println(monitor.getViewport());
    monitors.add(monitor);
  }
  System.out.println("*******************************");
  if (profile == null) {
    if (PJOGL.PROFILE == 2) {
      try {
        profile=GLProfile.getGL2ES1();
      }
 catch (      GLException ex) {
        profile=GLProfile.getMaxFixedFunc(true);
      }
    }
 else     if (PJOGL.PROFILE == 3) {
      try {
        profile=GLProfile.getGL2GL3();
      }
 catch (      GLException ex) {
        profile=GLProfile.getMaxProgrammable(true);
      }
      if (!profile.isGL3()) {
        PGraphics.showWarning("Requested profile GL3 but is not available, got: " + profile);
      }
    }
 else     if (PJOGL.PROFILE == 4) {
      try {
        profile=GLProfile.getGL4ES3();
      }
 catch (      GLException ex) {
        profile=GLProfile.getMaxProgrammable(true);
      }
      if (!profile.isGL4()) {
        PGraphics.showWarning("Requested profile GL4 but is not available, got: " + profile);
      }
    }
 else     throw new RuntimeException(PGL.UNSUPPORTED_GLPROF_ERROR);
  }
  GLCapabilities caps=new GLCapabilities(profile);
  caps.setAlphaBits(PGL.REQUESTED_ALPHA_BITS);
  caps.setDepthBits(PGL.REQUESTED_DEPTH_BITS);
  caps.setStencilBits(PGL.REQUESTED_STENCIL_BITS);
  caps.setSampleBuffers(true);
  caps.setNumSamples(2);
  caps.setBackgroundOpaque(true);
  caps.setOnscreen(true);
  pgl.capabilities=caps;
  sketchWidth=sketch.sketchWidth();
  sketchHeight=sketch.sketchHeight();
  window=GLWindow.create(screen,caps);
  window.setPosition(0,0);
  window.setSize(sketchWidth,sketchHeight);
  window.setVisible(true);
  int[] reqSurfacePixelScale=new int[]{ScalableSurface.IDENTITY_PIXELSCALE,ScalableSurface.IDENTITY_PIXELSCALE};
  window.setSurfaceScale(reqSurfacePixelScale);
  NEWTMouseListener mouseListener=new NEWTMouseListener();
  window.addMouseListener(mouseListener);
  NEWTKeyListener keyListener=new NEWTKeyListener();
  window.addKeyListener(keyListener);
  NEWTWindowListener winListener=new NEWTWindowListener();
  window.addWindowListener(winListener);
  DrawListener drawlistener=new DrawListener();
  window.addGLEventListener(drawlistener);
  animator=new FPSAnimator(window,60);
  window.addWindowListener(new WindowAdapter(){
    @Override public void windowDestroyNotify(    final WindowEvent e){
      animator.stop();
    }
  }
);
  frame=new DummyFrame();
  return frame;
}

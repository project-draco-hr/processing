{
  message("Saving file...");
  String s=textarea.getText();
  String directory=lastDirectory;
  String filename=lastFile;
  System.out.println("1");
  if (promptUser) {
    FileDialog fd=new FileDialog(new Frame(),"Save PDE program as...",FileDialog.SAVE);
    fd.setDirectory(lastDirectory);
    fd.setFile(lastFile);
    fd.show();
    directory=fd.getDirectory();
    filename=fd.getFile();
    if (filename == null) {
      message(EMPTY);
      buttons.clear();
      return;
    }
  }
  File file=new File(directory,filename);
  System.out.println("2");
  try {
    FileWriter writer=new FileWriter(file);
    writer.write(s);
    writer.flush();
    writer.close();
    System.out.println("3");
    lastDirectory=directory;
    lastFile=filename;
    message("Done saving " + filename + ".");
  }
 catch (  IOException e) {
    e.printStackTrace();
    message("Could not write " + filename + ".");
  }
  buttons.clear();
}

{
  doClose();
  running=true;
  buttons.run();
  try {
    String program=textarea.getText();
    makeHistory(program,RUN);
    String buildPath="lib" + File.separator + "build";
    if (PdeBase.platform == PdeBase.MACOSX) {
      String pkg="Proce55ing.app/Contents/Resources/Java/";
      buildPath=pkg + "build";
    }
    File buildDir=new File(buildPath);
    if (!buildDir.exists())     buildDir.mkdirs();
    String dataPath=sketchFile.getParent() + File.separator + "data";
    engine=new KjcEngine(this,program,buildPath,dataPath);
    engine.start(presenting ? presentLocation : appletLocation);
  }
 catch (  PdeException e) {
    engine.stop();
    e.printStackTrace();
    error(e);
  }
catch (  Exception e) {
    e.printStackTrace();
    engine.stop();
  }
}

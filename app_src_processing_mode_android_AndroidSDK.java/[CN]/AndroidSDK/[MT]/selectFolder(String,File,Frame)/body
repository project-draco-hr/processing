{
  if (Base.isMacOS()) {
    if (frame == null)     frame=new Frame();
    FileDialog fd=new FileDialog(frame,prompt,FileDialog.LOAD);
    if (folder != null) {
      fd.setDirectory(folder.getParent());
    }
    System.setProperty("apple.awt.fileDialogForDirectories","true");
    fd.setVisible(true);
    System.setProperty("apple.awt.fileDialogForDirectories","false");
    if (fd.getFile() == null) {
      return null;
    }
    return new File(fd.getDirectory(),fd.getFile());
  }
 else {
    JFileChooser fc=new JFileChooser();
    fc.setDialogTitle(prompt);
    if (folder != null) {
      fc.setSelectedFile(folder);
    }
    fc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
    int returned=fc.showOpenDialog(frame);
    if (returned == JFileChooser.APPROVE_OPTION) {
      return fc.getSelectedFile();
    }
  }
  return null;
}

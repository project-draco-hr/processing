{
  if (screen == null)   return;
  PdeSketch sketch=editor.sketch;
  Dimension size=getSize();
  if ((size.width != sizeW) || (size.height != sizeH)) {
    if ((size.width > imageW) || (size.height > imageH)) {
      offscreen=null;
    }
 else {
      sizeW=size.width;
      sizeH=size.height;
    }
  }
  if (offscreen == null) {
    sizeW=size.width;
    sizeH=size.height;
    imageW=sizeW;
    imageH=sizeH;
    offscreen=createImage(imageW,imageH);
  }
  Graphics g=offscreen.getGraphics();
  if (font == null) {
    font=PdePreferences.getFont("header.text.font");
    g.setFont(font);
    metrics=g.getFontMetrics();
    fontAscent=metrics.getAscent();
  }
  int x=PdePreferences.GUI_SMALL;
  for (int i=0; i < sketch.fileCount; i++) {
    String text=sketch.modified[i] ? ("  " + sketch.names[i] + "  ") : ("  " + sketch.names[i] + " \u00A7");
    int textWidth=metrics.stringWidth(text);
    int pieceCount=2 + (textWidth / PIECE_WIDTH);
    int pieceWidth=pieceCount * PIECE_WIDTH;
    state=(i == sketch.current) ? SELECTED : UNSELECTED;
    g.drawImage(pieces[state][LEFT],x,0,null);
    x+=PIECE_WIDTH;
    int contentLeft=x;
    for (int j=0; j < pieceCount; j++) {
      g.drawImage(pieces[state][MIDDLE],x,0,null);
      x+=PIECE_WIDTH;
    }
    int textLeft=contentLeft + (pieceWidth - textWidth) / 2;
    g.setColor(textColor[STATUS]);
    int baseline=(sizeH + fontAscent) / 2;
    g.drawString(names[i],textLeft,baseline);
    g.drawImage(pieces[state][RIGHT],x,0,null);
    x+=PIECE_WIDTH - 1;
  }
  screen.drawImage(offscreen,0,0,null);
}

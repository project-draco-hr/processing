{
  if (!project.isOpen())   return;
  IFolder codeFolder=project.getFolder("code");
  IFolder dataFolder=project.getFolder("data");
  IFolder buildFolder=project.getFolder("bin");
  IFolder appletFolder=project.getFolder("applet");
  IFolder javaBuildFolder=project.getFolder("compile");
  File coreResources=getCoreResourcesFolder();
  File sketchbookLibs=getSketchBookLibsFolder(project);
  if (!codeFolder.exists())   buildFolder.create(IResource.NONE,true,null);
  if (!dataFolder.exists())   dataFolder.create(IResource.NONE,true,null);
  if (!buildFolder.exists())   buildFolder.create(IResource.NONE,true,null);
  if (!appletFolder.exists())   appletFolder.create(IResource.NONE,true,null);
  if (!javaBuildFolder.exists())   javaBuildFolder.create(IResource.NONE,true,null);
  IJavaProject jproject=JavaCore.create(project);
  IPath containerPath=new Path(JavaRuntime.JRE_CONTAINER);
  IVMInstall vm=JavaRuntime.getDefaultVMInstall();
  IPath vmPath=containerPath.append(vm.getVMInstallType().getId()).append(vm.getName());
  List<IClasspathEntry> entries=new ArrayList<IClasspathEntry>();
  entries.add(JavaCore.newContainerEntry(vmPath.makeAbsolute()));
  entries.add(JavaCore.newSourceEntry(buildFolder.getFullPath().makeAbsolute()));
  entries.add(JavaCore.newContainerEntry(codeFolder.getFullPath().makeAbsolute()));
  if (coreResources != null)   entries.add(JavaCore.newContainerEntry(new Path(coreResources.getAbsolutePath())));
  if (sketchbookLibs != null)   entries.add(JavaCore.newContainerEntry(new Path(sketchbookLibs.getAbsolutePath())));
  IClasspathEntry[] classpathEntries=new IClasspathEntry[entries.size()];
  for (int i=0; i < entries.size(); i++) {
    classpathEntries[i]=entries.get(i);
  }
  jproject.setRawClasspath(classpathEntries,javaBuildFolder.getFullPath(),null);
  IProjectDescription description=this.project.getDescription();
  List<ICommand> newCmds=new ArrayList<ICommand>();
  newCmds.addAll(Arrays.asList(description.getBuildSpec()));
  int ploc=-1;
  for (int i=0; i < newCmds.size(); i++) {
    if (newCmds.get(i).getBuilderName().equals(SketchBuilder.BUILDER_ID))     ploc=i;
  }
  if (ploc == 0)   return;
  if (ploc > 0)   newCmds.remove(ploc);
  ICommand command=description.newCommand();
  command.setBuilderName(SketchBuilder.BUILDER_ID);
  newCmds.add(0,command);
  description.setBuildSpec((ICommand[])newCmds.toArray(new ICommand[newCmds.size()]));
  project.setDescription(description,null);
  project.refreshLocal(IResource.DEPTH_INFINITE,new NullProgressMonitor());
}

{
  pm.startTask("Removing",ProgressMonitor.UNKNOWN);
  boolean doBackup=Preferences.getBoolean("contribution.backup.on_remove");
  if (getType().requiresRestart() && getType() != ContributionType.MODE) {
    if (!doBackup || (doBackup && backup(editor,false,status))) {
      if (setDeletionFlag(true)) {
        contribListing.replaceContribution(this,this);
      }
    }
  }
 else {
    boolean success=false;
    if (getType() == ContributionType.MODE) {
      boolean isModeActive=false;
      ModeContribution m=(ModeContribution)this;
      for (      Editor e : editor.getBase().getEditors())       if (e.getMode().equals(m.getMode())) {
        isModeActive=true;
        break;
      }
      if (!isModeActive)       m.clearClassLoader(editor.getBase());
 else {
        if (!doBackup || (doBackup && backup(editor,false,status))) {
          if (setDeletionFlag(true)) {
            contribListing.replaceContribution(this,this);
          }
        }
        ContributionManager.refreshInstalled(editor);
        pm.finished();
        return;
      }
    }
    if (doBackup) {
      success=backup(editor,true,status);
    }
 else {
      Base.removeDir(getFolder());
      success=!getFolder().exists();
    }
    if (success) {
      Contribution advertisedVersion=contribListing.getAvailableContribution(this);
      if (advertisedVersion == null) {
        contribListing.removeContribution(this);
      }
 else {
        contribListing.replaceContribution(this,advertisedVersion);
      }
    }
 else {
      if (!doBackup) {
        status.setErrorMessage("Could not delete the contribution's files");
      }
    }
  }
  ContributionManager.refreshInstalled(editor);
  pm.finished();
}

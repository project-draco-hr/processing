{
  pm.startTask("Removing",ProgressMonitor.UNKNOWN);
  boolean doBackup=Preferences.getBoolean("contribution.backup.on_remove");
  boolean success=false;
  if (getType() == ContributionType.MODE) {
    boolean isModeActive=false;
    ModeContribution m=(ModeContribution)this;
    for (    Editor e : editor.getBase().getEditors())     if (e.getMode().equals(m.getMode())) {
      isModeActive=true;
      break;
    }
    if (!isModeActive)     m.clearClassLoader(editor.getBase());
 else {
      pm.cancel();
      Base.showMessage("Mode Manager","Please save your Sketch and change the Mode of all Editor\nwindows that have " + this.name + " as the active Mode.");
      return;
    }
  }
  if (getType() == ContributionType.TOOL) {
    ToolContribution t=(ToolContribution)this;
    for (    Editor ed : editor.getBase().getEditors())     ed.clearToolMenu();
    t.clearClassLoader(editor.getBase());
  }
  if (doBackup) {
    success=backup(editor,true,status);
  }
 else {
    Base.removeDir(getFolder());
    success=!getFolder().exists();
  }
  if (success) {
    if (getType() == ContributionType.TOOL) {
      editor.removeTool();
    }
    Contribution advertisedVersion=contribListing.getAvailableContribution(this);
    if (advertisedVersion == null) {
      contribListing.removeContribution(this);
    }
 else {
      contribListing.replaceContribution(this,advertisedVersion);
    }
  }
 else {
    if (getType().requiresRestart()) {
      if (!doBackup || (doBackup && backup(editor,false,status))) {
        status.setMessage("");
        if (setDeletionFlag(true)) {
          contribListing.replaceContribution(this,this);
        }
      }
 else       status.setErrorMessage("Could not delete the contribution's files");
    }
  }
  ContributionManager.refreshInstalled(editor);
  if (success)   pm.finished();
 else   pm.cancel();
}

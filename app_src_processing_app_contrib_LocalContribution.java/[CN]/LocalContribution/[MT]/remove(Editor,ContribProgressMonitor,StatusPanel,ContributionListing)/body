{
  pm.startTask("Removing",ContribProgressMonitor.UNKNOWN);
  boolean doBackup=Preferences.getBoolean("contribution.backup.on_remove");
  boolean success=false;
  if (getType() == ContributionType.MODE) {
    boolean isModeActive=false;
    ModeContribution m=(ModeContribution)this;
    Iterator<Editor> iter=editor.getBase().getEditors().iterator();
    while (iter.hasNext()) {
      Editor e=iter.next();
      if (e.getMode().equals(m.getMode())) {
        isModeActive=true;
        break;
      }
    }
    if (!isModeActive) {
      m.clearClassLoader(editor.getBase());
    }
 else {
      pm.cancel();
      Messages.showMessage("Mode Manager","Please save your Sketch and change the Mode of all Editor\n" + "windows that have " + name + " as the active Mode.");
      return;
    }
  }
  if (getType() == ContributionType.TOOL) {
    editor.getBase().clearToolMenus();
    ((ToolContribution)this).clearClassLoader();
  }
  if (doBackup) {
    success=backup(editor,true,status);
  }
 else {
    Util.removeDir(getFolder());
    success=!getFolder().exists();
  }
  if (success) {
    Contribution advertisedVersion=contribListing.getAvailableContribution(this);
    if (advertisedVersion == null) {
      contribListing.removeContribution(this);
    }
 else {
      contribListing.replaceContribution(this,advertisedVersion);
    }
  }
 else {
    if (!doBackup || (doBackup && backup(editor,false,status))) {
      if (setDeletionFlag(true)) {
        contribListing.replaceContribution(this,this);
      }
    }
 else {
      status.setErrorMessage("Could not delete the contribution's files");
    }
  }
  editor.getBase().refreshContribs(this.getType());
  if (success) {
    pm.finished();
  }
 else {
    pm.cancel();
  }
}

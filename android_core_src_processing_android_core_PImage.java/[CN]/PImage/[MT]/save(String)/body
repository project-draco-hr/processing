{
  boolean success=false;
  loadPixels();
  try {
    OutputStream output=parent.createOutput(path);
    String lower=path.toLowerCase();
    String extension=lower.substring(lower.lastIndexOf('.') + 1);
    if (extension.equals("jpg") || extension.equals("jpeg")) {
      Bitmap outgoing=Bitmap.createBitmap(pixels,width,height,Config.ARGB_8888);
      success=outgoing.compress(CompressFormat.JPEG,100,output);
    }
 else     if (extension.equals("png")) {
      Bitmap outgoing=Bitmap.createBitmap(pixels,width,height,Config.ARGB_8888);
      success=outgoing.compress(CompressFormat.PNG,100,output);
    }
 else     if (extension.equals("tga")) {
      success=saveTGA(output);
    }
 else {
      if (!extension.equals("tif") && !extension.equals("tiff")) {
        path+=".tif";
      }
      success=saveTIFF(output);
    }
    output.flush();
    output.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  if (!success) {
    System.err.println("Could not write the image to " + path);
  }
}

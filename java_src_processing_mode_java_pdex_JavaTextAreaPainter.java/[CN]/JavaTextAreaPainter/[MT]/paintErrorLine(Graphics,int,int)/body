{
  ErrorCheckerService ecs=getJavaEditor().getErrorChecker();
  if (ecs == null || ecs.lastCodeCheckResult.problems.isEmpty()) {
    return;
  }
  LineMarker marker=getJavaEditor().findError(line);
  if (marker != null) {
    Problem problem=marker.getProblem();
    int offset=textArea.getLineStartOffset(problem.getLineNumber());
    int startOffset=offset + problem.getPDELineStartOffset();
    int stopOffset=offset + problem.getPDELineStopOffset() + 1;
    int lineOffset=textArea.getLineStartOffset(line);
    int wiggleStart=Math.max(startOffset,lineOffset);
    int wiggleStop=Math.min(stopOffset,textArea.getLineStopOffset(line));
    int y=textArea.lineToY(line) + fm.getLeading() + fm.getMaxDescent();
    try {
      String badCode=null;
      String goodCode=null;
      try {
        SyntaxDocument doc=textArea.getDocument();
        badCode=doc.getText(wiggleStart,wiggleStop - wiggleStart);
        goodCode=doc.getText(lineOffset,wiggleStart - lineOffset);
      }
 catch (      BadLocationException bl) {
        return;
      }
      int aw=fm.stringWidth(trimRight(badCode)) + textArea.getHorizontalOffset();
      int rw=fm.stringWidth(badCode.trim());
      int x1=fm.stringWidth(goodCode) + (aw - rw);
      int y1=y + fm.getHeight() - 2, x2=x1 + rw;
      if (line != problem.getLineNumber()) {
        x1=0;
      }
      x1+=Editor.LEFT_GUTTER;
      x2+=Editor.LEFT_GUTTER;
      gfx.setColor(errorUnderlineColor);
      if (marker.getType() == LineMarker.WARNING) {
        gfx.setColor(warningUnderlineColor);
      }
      paintSquiggle(gfx,y1,x1,x2);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
}

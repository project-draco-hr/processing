{
  ErrorCheckerService ecs=getJavaEditor().getErrorChecker();
  if (ecs == null || ecs.lastCodeCheckResult.problems.isEmpty()) {
    return;
  }
  LineMarker marker=getJavaEditor().findError(line);
  if (marker != null) {
    Problem problem=marker.getProblem();
    int offset=textArea.getLineStartOffset(problem.getLineNumber());
    int startOffset=offset + problem.getPDELineStartOffset();
    int stopOffset=offset + problem.getPDELineStopOffset() + 1;
    int lineOffset=textArea.getLineStartOffset(line);
    int wiggleStart=Math.max(startOffset,lineOffset);
    int wiggleStop=Math.min(stopOffset,textArea.getLineStopOffset(line));
    int y=textArea.lineToY(line) + fm.getLeading() + fm.getMaxDescent();
    try {
      String badCode=null;
      String goodCode=null;
      try {
        SyntaxDocument doc=textArea.getDocument();
        badCode=doc.getText(wiggleStart,wiggleStop - wiggleStart);
        goodCode=doc.getText(lineOffset,wiggleStart - lineOffset);
      }
 catch (      BadLocationException bl) {
        return;
      }
      int trimmedLength=badCode.trim().length();
      int rightTrimmedLength=trimRight(badCode).length();
      int leftTrimLength=rightTrimmedLength - trimmedLength;
      int x1=textArea.offsetToX(line,goodCode.length() + leftTrimLength);
      int x2=textArea.offsetToX(line,goodCode.length() + rightTrimmedLength);
      int y1=y + fm.getHeight() - 2;
      if (line != problem.getLineNumber()) {
        x1=Editor.LEFT_GUTTER;
      }
      gfx.setColor(errorUnderlineColor);
      if (marker.getType() == LineMarker.WARNING) {
        gfx.setColor(warningUnderlineColor);
      }
      paintSquiggle(gfx,y1,x1,x2);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
}

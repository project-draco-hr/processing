{
  Sketch sketch=editor.getSketch();
  if (sketch.isModified()) {
    int result=JOptionPane.showConfirmDialog(editor,"Discard all changes and reload sketch?","Fix Encoding & Reload",JOptionPane.YES_NO_OPTION,JOptionPane.QUESTION_MESSAGE);
    if (result == JOptionPane.NO_OPTION) {
      return;
    }
  }
  try {
    for (int i=0; i < sketch.getCodeCount(); i++) {
      SketchCode code=sketch.getCode(i);
      code.program=loadWithLocalEncoding(code.getFile());
      code.modified=true;
    }
    editor.setText(sketch.getCurrentCode().program);
  }
 catch (  IOException e) {
    String msg="An error occurred while trying to fix the file encoding.\n" + "Do not attempt to save this sketch as it may overwrite\n" + "the old version. Use Open to re-open the sketch and try again.\n"+ e.getMessage();
    Base.showWarning("Fix Encoding & Reload",msg,e);
  }
}

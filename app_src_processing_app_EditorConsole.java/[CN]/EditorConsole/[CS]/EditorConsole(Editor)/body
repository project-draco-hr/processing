{
  this.editor=editor;
  maxLineCount=Preferences.getInteger("console.length");
  consoleDoc=new BufferedStyledDocument(10000,maxLineCount);
  consoleTextPane=new JTextPane(consoleDoc);
  consoleTextPane.setEditable(false);
  MutableAttributeSet standard=new SimpleAttributeSet();
  StyleConstants.setAlignment(standard,StyleConstants.ALIGN_LEFT);
  consoleDoc.setParagraphAttributes(0,0,standard,true);
  Color bgColor=Preferences.getColor("console.color");
  Color fgColorOut=Preferences.getColor("console.output.color");
  Color fgColorErr=Preferences.getColor("console.error.color");
  Font font=Preferences.getFont("console.font");
  stdStyle=new SimpleAttributeSet();
  StyleConstants.setForeground(stdStyle,fgColorOut);
  StyleConstants.setBackground(stdStyle,bgColor);
  StyleConstants.setFontSize(stdStyle,font.getSize());
  StyleConstants.setFontFamily(stdStyle,font.getFamily());
  StyleConstants.setBold(stdStyle,font.isBold());
  StyleConstants.setItalic(stdStyle,font.isItalic());
  errStyle=new SimpleAttributeSet();
  StyleConstants.setForeground(errStyle,fgColorErr);
  StyleConstants.setBackground(errStyle,bgColor);
  StyleConstants.setFontSize(errStyle,font.getSize());
  StyleConstants.setFontFamily(errStyle,font.getFamily());
  StyleConstants.setBold(errStyle,font.isBold());
  StyleConstants.setItalic(errStyle,font.isItalic());
  consoleTextPane.setBackground(bgColor);
  this.setViewportView(consoleTextPane);
  FontMetrics metrics=this.getFontMetrics(font);
  int height=metrics.getAscent() + metrics.getDescent();
  int lines=Preferences.getInteger("console.lines");
  int sizeFudge=6;
  setPreferredSize(new Dimension(1024,(height * lines) + sizeFudge));
  setMinimumSize(new Dimension(1024,(height * 4) + sizeFudge));
  if (systemOut == null) {
    systemOut=System.out;
    systemErr=System.err;
    tempFolder=Base.createTempFolder("console");
    try {
      String outFileName=Preferences.get("console.output.file");
      if (outFileName != null) {
        outFile=new File(tempFolder,outFileName);
        stdoutFile=new FileOutputStream(outFile);
      }
      String errFileName=Preferences.get("console.error.file");
      if (errFileName != null) {
        errFile=new File(tempFolder,errFileName);
        stderrFile=new FileOutputStream(errFile);
      }
    }
 catch (    IOException e) {
      Base.showWarning("Console Error","A problem occurred while trying to open the\n" + "files used to store the console output.",e);
    }
    consoleOut=new PrintStream(new EditorConsoleStream(this,false,stdoutFile));
    consoleErr=new PrintStream(new EditorConsoleStream(this,true,stderrFile));
    if (Preferences.getBoolean("console")) {
      try {
        System.setOut(consoleOut);
        System.setErr(consoleErr);
      }
 catch (      Exception e) {
        e.printStackTrace(systemOut);
      }
    }
  }
  if (Base.isMacOS()) {
    setBorder(null);
  }
  new javax.swing.Timer(250,new ActionListener(){
    public void actionPerformed(    ActionEvent evt){
      if (consoleDoc.hasAppendage) {
        consoleDoc.insertAll();
        consoleTextPane.setCaretPosition(consoleDoc.getLength());
      }
    }
  }
).start();
}

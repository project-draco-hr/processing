{
  int height=0;
  int width=0;
  for (  Component c : getComponents()) {
    if (c.isVisible()) {
      if (c instanceof LibraryPanel) {
        Dimension d=c.getPreferredSize();
        if (d.width > width) {
          width=d.width;
        }
        height+=d.height;
      }
    }
  }
  Rectangle r=getVisibleRect();
  if (obtainedSpaceIsAbove && preferredViewPositionListener != null) {
    Point p=new Point(r.x,r.y);
    p.y-=obtainedSpace;
    preferredViewPositionListener.handlePreferredLocation(p);
  }
  setPreferredSize(new Dimension(width,height));
}

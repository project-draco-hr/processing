{
  WritableRaster raster=null;
  if (primarySurface) {
    if (useOffscreen) {
      raster=((BufferedImage)offscreen).getRaster();
    }
 else     if (image instanceof VolatileImage) {
      raster=((VolatileImage)image).getSnapshot().getRaster();
    }
  }
 else {
    raster=((BufferedImage)image).getRaster();
  }
  if (raster.getTransferType() != DataBuffer.TYPE_INT) {
    System.err.println("See https://github.com/processing/processing/issues/2010");
    throw new RuntimeException("Pixel operations are not supported on this device.");
  }
  return raster;
}

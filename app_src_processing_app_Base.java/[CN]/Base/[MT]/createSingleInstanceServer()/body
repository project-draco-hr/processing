{
  try {
    final ServerSocket ss=new ServerSocket(0,0,InetAddress.getByName(null));
    Preferences.set("server.port","" + ss.getLocalPort());
    final String key="" + Math.random();
    Preferences.set("server.key",key);
    Preferences.save();
    new Thread(new Runnable(){
      public void run(){
        while (true) {
          try {
            Socket s=ss.accept();
            BufferedReader br=new BufferedReader(new InputStreamReader(s.getInputStream()));
            String receivedKey=br.readLine();
            if (platform.base == null)             continue;
            if (key.equals(receivedKey)) {
              final String filename=br.readLine();
              SwingUtilities.invokeLater(new Runnable(){
                public void run(){
                  if (filename != null) {
                    platform.base.handleOpen(filename);
                  }
 else {
                    platform.base.handleNew();
                  }
                }
              }
);
            }
          }
 catch (          IOException e) {
          }
        }
      }
    }
).start();
  }
 catch (  IOException e) {
  }
}

{
  if (activeEditor.getMode() != mode) {
    Sketch sketch=activeEditor.getSketch();
    if (sketch.isModified()) {
      Base.showWarning("Save","Please save the sketch before changing the mode.",null);
    }
 else {
      boolean untitled=activeEditor.untitled;
      String mainPath=sketch.getMainFilePath();
      File sketchProps=new File(sketch.getFolder(),"sketch.properties");
      try {
        Settings props=new Settings(sketchProps);
        props.set("mode",mode.getTitle());
        props.save();
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
      int[] where=activeEditor.getPlacement();
      handleClose(activeEditor,true);
      Editor editor=handleOpen(mainPath,where);
      if (editor != null) {
        editor.untitled=untitled;
      }
    }
  }
}

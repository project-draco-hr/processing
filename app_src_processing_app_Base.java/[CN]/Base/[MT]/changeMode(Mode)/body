{
  if (activeEditor.getMode() != mode) {
    Sketch sketch=activeEditor.getSketch();
    if (sketch.isModified()) {
      Base.showWarning("Save","Please save the sketch before changing the mode.",null);
    }
 else {
      boolean untitled=activeEditor.untitled;
      String mainPath=sketch.getMainFilePath();
      File sketchProps=new File(sketch.getFolder(),"sketch.properties");
      PrintWriter writer=PApplet.createWriter(sketchProps);
      writer.println("mode=" + mode.getTitle());
      writer.flush();
      writer.close();
      int[] where=activeEditor.getPlacement();
      handleClose(activeEditor);
      Editor editor=handleOpen(mainPath,where);
      if (editor != null) {
        editor.untitled=untitled;
      }
    }
  }
}

{
  try {
    popup.removeAll();
    JMenuItem item=new JMenuItem("Open...");
    item.addActionListener(new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        editor.handleOpen(null);
      }
    }
);
    popup.add(item);
    popup.addSeparator();
    boolean sketches=addSketches(popup,new File(PdePreferences.get("sketchbook.path")));
    if (sketches)     popup.addSeparator();
    JMenu ex=new JMenu("Examples");
    addSketches(ex,examplesFolder);
    popup.add(ex);
    if (PdePreferences.getBoolean("export.library")) {
      JMenu m=new JMenu("Libraries");
      addSketches(m,librariesFolder);
      popup.add(m);
    }
    builtOnce=true;
    menu.removeAll();
    if (sketches) {
      addSketches(menu,new File(PdePreferences.get("sketchbook.path")));
    }
    examples=new JMenu("Examples");
    addSketches(examples,examplesFolder);
    addlib.removeAll();
    librariesClassPath="";
    boolean libs=addLibraries(addlib,new File(PdePreferences.get("sketchbook.path")));
    if (libs)     addlib.addSeparator();
    addLibraries(addlib,librariesFolder);
  }
 catch (  IOException e) {
    PdeBase.showWarning("Problem while building sketchbook menu","There was a problem with building the\n" + "sketchbook menu. Things might get a little\n" + "kooky around here.",e);
  }
  return menu;
}

{
  modePopup=new JMenu();
  ButtonGroup modeGroup=new ButtonGroup();
  for (  final Mode m : base.getModeList()) {
    JRadioButtonMenuItem item=new JRadioButtonMenuItem(m.getTitle());
    item.addActionListener(new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        if (!sketch.isModified()) {
          base.changeMode(m);
        }
 else {
          Messages.showWarning("Save","Please save the sketch before changing the mode.");
          for (          Component c : getModePopup().getComponents()) {
            if (c instanceof JRadioButtonMenuItem) {
              if (((JRadioButtonMenuItem)c).getText() == mode.getTitle()) {
                ((JRadioButtonMenuItem)c).setSelected(true);
                break;
              }
            }
          }
        }
      }
    }
);
    modePopup.add(item);
    modeGroup.add(item);
    if (mode == m) {
      item.setSelected(true);
    }
  }
  modePopup.addSeparator();
  JMenuItem addLib=new JMenuItem(Language.text("toolbar.add_mode"));
  addLib.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      ContributionManager.openModeManager(Editor.this);
    }
  }
);
  modePopup.add(addLib);
  Toolkit.setMenuMnemsInside(modePopup);
}

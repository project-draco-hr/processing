{
  final Project p=new Project();
  String path=buildFile.getAbsolutePath().replace('\\','/');
  p.setUserProperty("ant.file",path);
  p.setUserProperty("build.compiler","extJavac");
  final DefaultLogger consoleLogger=new DefaultLogger();
  consoleLogger.setErrorPrintStream(System.err);
  consoleLogger.setMessageOutputLevel(Project.MSG_ERR);
  p.addBuildListener(consoleLogger);
  final DefaultLogger errorLogger=new DefaultLogger();
  final ByteArrayOutputStream errb=new ByteArrayOutputStream();
  final PrintStream errp=new PrintStream(errb);
  errorLogger.setErrorPrintStream(errp);
  final ByteArrayOutputStream outb=new ByteArrayOutputStream();
  final PrintStream outp=new PrintStream(outb);
  errorLogger.setOutputPrintStream(outp);
  errorLogger.setMessageOutputLevel(Project.MSG_INFO);
  p.addBuildListener(errorLogger);
  try {
    editor.statusNotice("Building sketch for Android...");
    p.fireBuildStarted();
    p.init();
    final ProjectHelper helper=ProjectHelper.getProjectHelper();
    p.addReference("ant.projectHelper",helper);
    helper.parse(p,buildFile);
    p.executeTarget(target);
    editor.statusNotice("Finished building sketch.");
    return true;
  }
 catch (  final BuildException e) {
    p.fireBuildFinished(e);
    final String outPile=new String(outb.toByteArray());
    final String[] outLines=outPile.split(System.getProperty("line.separator"));
    for (    final String line : outLines) {
      final String javacPrefix="[javac]";
      final int javacIndex=line.indexOf(javacPrefix);
      if (javacIndex != -1) {
        int offset=javacIndex + javacPrefix.length() + 1;
        String[] pieces=PApplet.match(line.substring(offset),"^(.+):([0-9]+):\\s+(.+)$");
        if (pieces != null) {
          String fileName=pieces[1];
          fileName=fileName.substring(fileName.lastIndexOf('/') + 1);
          final int lineNumber=PApplet.parseInt(pieces[2]) - 1;
          final SketchException rex=placeException(pieces[3],fileName,lineNumber);
          if (rex != null) {
            rex.hideStackTrace();
            editor.statusError(rex);
            return false;
          }
        }
      }
    }
    editor.statusError(e);
  }
  return false;
}

{
  tmpFolder=createTempBuildFolder(sketch);
  srcFolder=new File(tmpFolder,"src");
  binFolder=srcFolder;
  if (processing.app.Base.DEBUG) {
    Base.openFolder(tmpFolder);
  }
  manifest=new Manifest(sketch);
  AndroidPreprocessor preproc=new AndroidPreprocessor(sketch,getPackageName());
  preproc.initSketchSize(sketch.getMainProgram());
  sketchClassName=preprocess(srcFolder,manifest.getPackageName(),preproc);
  if (sketchClassName != null) {
    File tempManifest=new File(tmpFolder,"AndroidManifest.xml");
    manifest.writeBuild(tempManifest,sketchClassName,target.equals("debug"));
    writeAntProps(new File(tmpFolder,"ant.properties"));
    buildFile=new File(tmpFolder,"build.xml");
    writeBuildXML(buildFile,sketch.getName());
    writeProjectProps(new File(tmpFolder,"project.properties"));
    writeLocalProps(new File(tmpFolder,"local.properties"));
    writeRes(new File(tmpFolder,"res"),sketchClassName);
    final File libsFolder=mkdirs(tmpFolder,"libs");
    final File assetsFolder=mkdirs(tmpFolder,"assets");
    Base.copyFile(coreZipFile,new File(libsFolder,"processing-core.jar"));
    copyLibraries(libsFolder,assetsFolder);
    copyCodeFolder(libsFolder);
    final File sketchDataFolder=sketch.getDataFolder();
    if (sketchDataFolder.exists()) {
      Base.copyDir(sketchDataFolder,assetsFolder);
    }
  }
  return tmpFolder;
}

{
  if (devices.remove(device.getId()) == null) {
    throw new IllegalStateException("I didn't know about device " + device.getId() + "!");
  }
}
